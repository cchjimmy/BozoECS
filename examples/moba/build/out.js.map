{
  "version": 3,
  "sources": ["../../../src/pool.ts", "../../../src/component.ts", "../../../src/entity.ts", "../../../src/world.ts", "../src/config.json", "../src/main.ts"],
  "sourcesContent": ["export class ObjectPoolMap<K, V> {\n  private storage: V[] = [];\n  private keyToIndex: Map<K, number> = new Map();\n  private indexToKey: K[] = [];\n  private objectFactory: () => V;\n\n  constructor(objectFactory: () => V) {\n    this.objectFactory = objectFactory;\n  }\n\n  size() {\n    return this.keyToIndex.size;\n  }\n\n  add(key: K): V {\n    if (this.keyToIndex.has(key))\n      return this.storage[this.keyToIndex.get(key) as number];\n    if (this.storage.length <= this.keyToIndex.size)\n      this.storage.push(this.objectFactory());\n    this.keyToIndex.set(key, this.keyToIndex.size);\n    this.indexToKey[this.keyToIndex.size - 1] = key;\n    return this.storage[this.keyToIndex.get(key) as number];\n  }\n\n  remove(key: K): void {\n    const index = this.keyToIndex.get(key);\n    if (index == undefined) return;\n    const backKey = this.indexToKey[this.keyToIndex.size - 1];\n    const temp = this.storage[index];\n    this.storage[index] = this.storage[this.keyToIndex.size - 1];\n    this.storage[this.keyToIndex.size - 1] = temp;\n    this.indexToKey[index] = backKey;\n    this.indexToKey.pop();\n    this.keyToIndex.set(backKey, index);\n    this.keyToIndex.delete(key);\n  }\n\n  get(key: K): V {\n    const index = this.keyToIndex.get(key);\n    if (index == undefined) throw new Error(\"Key not found.\");\n    return this.storage[index];\n  }\n\n  has(key: K): boolean {\n    return this.keyToIndex.has(key);\n  }\n\n  clean(): void {\n    this.storage.splice(this.keyToIndex.size);\n  }\n}\n", "import { ObjectPoolMap } from \"./pool.ts\";\nimport { entityT } from \"./entity.ts\";\n\nexport class ComponentManager {\n  private poolMap: Map<object, ObjectPoolMap<entityT, object>> = new Map();\n  private idMap: Map<object, number> = new Map();\n\n  register<T extends object>(component: T): void {\n    if (this.poolMap.has(component)) return;\n    this.idMap.set(component, this.idMap.size);\n    this.poolMap.set(\n      component,\n      new ObjectPoolMap<entityT, T>(() => ({ ...component })),\n    );\n  }\n\n  getId<T extends object>(component: T): number {\n    const mask = this.idMap.get(component);\n    if (mask != undefined) return mask;\n    this.register(component);\n    return this.idMap.get(component) as number;\n  }\n\n  add<T extends object>(entity: entityT, component: T): T {\n    return Object.assign(\n      (this.poolMap.get(component) as ObjectPoolMap<entityT, T>).add(entity),\n      component,\n    );\n  }\n\n  remove<T extends object>(entity: entityT, component: T): void {\n    (this.poolMap.get(component) as ObjectPoolMap<entityT, T>).remove(entity);\n  }\n\n  has<T extends object>(entity: entityT, component: T): boolean {\n    return (\n      this.poolMap.has(component) &&\n      (this.poolMap.get(component) as ObjectPoolMap<entityT, T>).has(entity)\n    );\n  }\n\n  get<T extends object>(entity: entityT, component: T): T {\n    return (this.poolMap.get(component) as ObjectPoolMap<entityT, T>).get(\n      entity,\n    );\n  }\n\n  size<T extends object>(component: T): number {\n    return (this.poolMap.get(component) as ObjectPoolMap<entityT, T>).size();\n  }\n\n  delete(entity: entityT): void {\n    for (const entry of this.poolMap.entries()) entry[1].remove(entity);\n  }\n\n  copy(src: entityT, dest: entityT): void {\n    for (const entry of this.poolMap.entries())\n      entry[1].has(src) && Object.assign(entry[1].add(dest), entry[1].get(src));\n  }\n\n  clean(): void {\n    for (const entry of this.poolMap.entries()) entry[1].clean();\n  }\n}\n", "export type entityT = number;\nexport function newEntity(): entityT {\n  return Math.random();\n}\n", "import { ComponentManager } from \"./component.ts\";\nimport { newEntity, type entityT } from \"./entity.ts\";\n\nexport type queryT = Partial<Record<\"and\" | \"not\", object[]>>;\n\nexport type systemT = (world: World) => void;\n\nexport class World {\n  private compEntityMap: Map<number, Set<entityT>> = new Map();\n  private compManager = new ComponentManager();\n  private entitySet: Set<entityT> = new Set();\n\n  addEntity(entity: entityT = newEntity()): entityT {\n    this.entitySet.add(entity);\n    return entity;\n  }\n\n  copyEntity(src: entityT, dest: entityT = newEntity()): entityT {\n    this.compManager.copy(src, dest);\n    for (const entry of this.compEntityMap) {\n      if (!entry[1].has(src)) continue;\n      entry[1].add(dest);\n    }\n    this.entitySet.add(dest);\n    return dest;\n  }\n\n  private getCompEntityMap(compId: number): Set<entityT> {\n    const a = this.compEntityMap.get(compId) ?? new Set();\n    this.compEntityMap.set(compId, a);\n    return a;\n  }\n\n  deleteEntity(entity: entityT) {\n    this.compManager.delete(entity);\n    for (const entry of this.compEntityMap) {\n      entry[1].delete(entity);\n    }\n    this.entitySet.delete(entity);\n  }\n\n  registerComponent<T extends object>(component: T): World {\n    this.compManager.register(component);\n    return this;\n  }\n\n  hasComponent<T extends object>(entity: entityT, component: T): boolean {\n    return this.compManager.has(entity, component);\n  }\n\n  addComponent<T extends object>(\n    entity: entityT,\n    component: T,\n    values: Partial<T> = component,\n  ): T {\n    this.compManager.register(component);\n    const cem = this.getCompEntityMap(this.compManager.getId(component));\n    if (cem.has(entity))\n      return Object.assign(this.compManager.get(entity, component), values);\n    cem.add(entity);\n    return Object.assign(this.compManager.add(entity, component), values);\n  }\n\n  removeComponent<T extends object>(entity: entityT, component: T): void {\n    this.compManager.register(component);\n    const cem = this.getCompEntityMap(this.compManager.getId(component));\n    if (!cem.has(entity)) return;\n    cem.delete(entity);\n  }\n\n  getComponent<T extends object>(entity: entityT, component: T): T {\n    return this.compManager.get(entity, component);\n  }\n\n  update(...fns: systemT[]) {\n    for (let i = 0, l = fns.length; i < l; i++) fns[i](this);\n  }\n\n  cleanObjectPools(): void {\n    this.compManager.clean();\n  }\n\n  query(query: queryT): entityT[] {\n    let res: Set<entityT> = this.entitySet;\n    if (query.and) {\n      for (const comp of query.and) {\n        res = res.intersection(\n          this.getCompEntityMap(this.compManager.getId(comp)),\n        );\n      }\n    }\n    if (query.not) {\n      for (const comp of query.not) {\n        res = res.difference(\n          this.getCompEntityMap(this.compManager.getId(comp)),\n        );\n      }\n    }\n    return [...res];\n  }\n\n  entityCount(): number {\n    return this.entitySet.size;\n  }\n}\n", "{\n  \"viewport\": {\n    \"width\": 800,\n    \"height\": 400\n  },\n  \"entities\": {\n    \"player\": {\n      \"healthPoint\": 10,\n      \"moveSpeed\": 20\n    },\n    \"minion\": {\n      \"healthPoint\": 15,\n      \"spawnRate\": 1\n    },\n    \"turrent\": {\n      \"healthPoint\": 100,\n      \"abilityPower\": 100\n    }\n  }\n}\n", "/**\n * By Original PNG version by Raizin, SVG rework by Sameboat. - file:Map of MOBA.png (CC 3.0), CC BY-SA 3.0, https://commons.wikimedia.org/w/index.php?curid=29443207\n */\n\nimport { entityT, World } from \"bozoecs\";\nimport { default as config } from \"./config.json\" with { type: \"json\" };\n\n// components\nconst Hierarchy = { parent: -1, children: [] };\nconst PIDController = {\n  kp: 0,\n  ki: 0,\n  kd: 0,\n  prevErr: 0,\n  accumErr: 0,\n  currentErr: 0,\n  result: 0,\n  reset: false,\n};\nconst Stats = {\n  attackPoint: 0,\n  defencePoint: 0,\n  abilityPower: 0,\n  moveSpeed: 0,\n  attackSpeed: 0,\n};\nconst Health = { current: 0, max: 0 };\nconst Callback = { callback: (_: entityT) => {} };\nconst Transform = { x: 0, y: 0, rad: 0, scaleX: 1, scaleY: 1 };\nconst Velocity = { x: 0, y: 0 };\nconst IsPlayer = {};\nconst OnScreen = {};\nconst ParticleEmitter = {\n  spreadRadians: 0,\n  particleEntity: -1,\n  particleLifetimeSeconds: 1,\n  particleSpeed: 1,\n  emit: false,\n  particleTransition: function (\n    world: World,\n    particleEntity: entityT,\n    percentageLifeTime: number,\n  ) {\n    const t = world.getComponent(particleEntity, Transform);\n    t.scaleX = t.scaleY = -((2 * percentageLifeTime - 1) ** 10) + 1;\n  },\n};\nconst Camera = { zoom: 20, tilt: 0, isActive: false, targetEntity: -1 };\nconst Rect = { width: 1, height: 1, x: -0.5, y: -0.5 };\nconst Graphic = { image: new Image() };\nconst Button = { hovered: false, pressed: false, clicked: false };\nconst Colour = { fill: \"white\", stroke: \"black\" };\nconst Text = {\n  content: \"\",\n  fontSize: 20,\n  padding: 3,\n  color: \"black\",\n  backgroundColor: \"white\",\n};\nconst Timer = { timeMilli: 0, reset: false, stop: false };\nconst PathFinder = { targetX: 0, targetY: 0 };\n\n// singletons\nconst Ctx2D = setUpCanvas2D();\nconst Pointer = setUpPointer();\nconst Keys = setUpKeyboard();\nconst Time = setUpTime();\n\nfunction setUpCanvas2D(): {\n  canvas: HTMLCanvasElement;\n  ctx: CanvasRenderingContext2D;\n} {\n  const canvas =\n    document.querySelector(\"canvas\") ?? document.createElement(\"canvas\");\n  if (!canvas) throw new Error(\"Cannot create canvas element.\");\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) throw new Error(\"Cannot initialize context 2d.\");\n\n  !document.querySelector(\"canvas\") && document.body.appendChild(canvas);\n\n  globalThis.onresize = globalThis.onload = () => {\n    if (innerWidth / innerHeight < canvas.width / canvas.height) {\n      canvas.style.width = \"100%\";\n      canvas.style.height = \"\";\n    } else {\n      canvas.style.width = \"\";\n      canvas.style.height = \"100%\";\n    }\n  };\n\n  return { canvas, ctx };\n}\nfunction setUpKeyboard(): Record<\n  \"isDown\" | \"justPressed\" | \"justReleased\",\n  Record<string, boolean>\n> {\n  const keys: ReturnType<typeof setUpKeyboard> = {\n    isDown: {},\n    justPressed: {},\n    justReleased: {},\n  };\n\n  globalThis.onkeydown = (e) => {\n    !keys.isDown[e.key] && (keys.justPressed[e.key] = true);\n    keys.isDown[e.key] = true;\n  };\n  globalThis.onkeyup = (e) => {\n    keys.isDown[e.key] = false;\n    keys.justReleased[e.key] = true;\n  };\n\n  return keys;\n}\nfunction updateKeyboard(\n  keys: Record<\n    \"isDown\" | \"justPressed\" | \"justReleased\",\n    Record<string, boolean>\n  >,\n) {\n  for (const key in keys.justPressed) keys.justPressed[key] = false;\n  for (const key in keys.justReleased) keys.justReleased[key] = false;\n}\nfunction setUpPointer() {\n  const pointer = {\n    x: 0,\n    y: 0,\n    isDown: false,\n    justPressed: false,\n    justReleased: false,\n    pressPos: { x: 0, y: 0 },\n    releasePos: { x: 0, y: 0 },\n  };\n\n  globalThis.onpointerdown = (e) => {\n    if (!(e.target instanceof HTMLCanvasElement)) return;\n    ((pointer.x = e.x), (pointer.y = e.y));\n    Object.assign(pointer.pressPos, pointer);\n    pointer.isDown = pointer.justPressed = true;\n  };\n\n  globalThis.onpointerup = (e) => {\n    ((pointer.x = e.x), (pointer.y = e.y));\n    Object.assign(pointer.releasePos, pointer);\n    ((pointer.isDown = false), (pointer.justReleased = true));\n  };\n\n  globalThis.onpointermove = (e) => {\n    ((pointer.x = e.x), (pointer.y = e.y));\n  };\n\n  return pointer;\n}\nfunction updatePointer(\n  pointer: Record<\"isDown\" | \"justPressed\" | \"justReleased\", boolean>,\n) {\n  pointer.justPressed = false;\n  pointer.justReleased = false;\n}\nfunction setUpTime() {\n  return { dtMilli: 0, timeMilli: 0, dtSeconds: 0, timeSeconds: 0 };\n}\nfunction updateTime(time: {\n  dtMilli: number;\n  timeMilli: number;\n  dtSeconds: number;\n  timeSeconds: number;\n}) {\n  time.dtMilli = performance.now() - time.timeMilli;\n  time.timeMilli += time.dtMilli;\n  time.dtSeconds = time.dtMilli / 1000;\n  time.timeSeconds = time.timeMilli / 1000;\n}\n\n// systems\nfunction checkOnScreenEntities(world: World) {\n  const camEntity = world\n    .query({ and: [Camera, Transform] })\n    .find((e) => world.getComponent(e, Camera).isActive);\n  if (!camEntity) return;\n  const cam = world.getComponent(camEntity, Camera);\n  const camTransform = world.getComponent(camEntity, Transform);\n  world.query({ and: [Rect, Transform] }).forEach((e) => {\n    const r = world.getComponent(e, Rect);\n    const t = world.getComponent(e, Transform);\n    rectsOverlap(\n      camTransform.x,\n      camTransform.y,\n      Ctx2D.canvas.width / cam.zoom,\n      Ctx2D.canvas.height / cam.zoom,\n      t.x + r.x + r.width / 2,\n      t.y + r.y + r.height / 2,\n      r.width,\n      r.height,\n    )\n      ? world.addComponent(e, OnScreen)\n      : world.removeComponent(e, OnScreen);\n  });\n}\nfunction handlePIDControllers(world: World) {\n  world.query({ and: [PIDController] }).forEach((e) => {\n    const pid = world.getComponent(e, PIDController);\n    pid.result =\n      pid.kp * pid.currentErr +\n      pid.ki * pid.accumErr +\n      (pid.kd * (pid.currentErr - pid.prevErr) * 1000) / Time.dtMilli;\n    pid.prevErr = pid.currentErr * +!pid.reset;\n    pid.accumErr = (pid.accumErr + pid.currentErr) * +!pid.reset;\n  });\n}\nfunction handleParticleEmitters(world: World) {\n  world.query({ and: [ParticleEmitter, Transform] }).forEach((e) => {\n    const emitter = world.getComponent(e, ParticleEmitter);\n    if (!emitter.emit) return;\n    emitter.emit = false;\n    const t = world.getComponent(e, Transform);\n    const particle = world.copyEntity(emitter.particleEntity);\n    world.addComponent(particle, Transform, t);\n    const timer = world.addComponent(particle, Timer);\n    const rad = t.rad + emitter.spreadRadians * (Math.random() - 0.5);\n    world.addComponent(particle, Velocity, {\n      x: Math.cos(rad) * emitter.particleSpeed,\n      y: Math.sin(rad) * emitter.particleSpeed,\n    });\n    world.addComponent(particle, Callback).callback = () => {\n      if (timer.timeMilli < emitter.particleLifetimeSeconds * 1000) {\n        emitter.particleTransition(\n          world,\n          particle,\n          timer.timeMilli / 1000 / emitter.particleLifetimeSeconds,\n        );\n        return;\n      }\n      world.deleteEntity(particle);\n    };\n  });\n}\nfunction handleInput(world: World) {\n  const camEntity = world\n    .query({ and: [Camera, Transform] })\n    .find((e) => world.getComponent(e, Camera).isActive);\n  if (camEntity == undefined) return;\n  const camera = world.getComponent(camEntity, Camera);\n  const camTransform = world.getComponent(camEntity, Transform);\n  const pressPos = pointerToScreen(Pointer.pressPos, Ctx2D.canvas);\n  world.query({ and: [PathFinder, IsPlayer] }).forEach((e) => {\n    if (!Pointer.justPressed) return;\n    const pf = world.getComponent(e, PathFinder);\n    const worldPos = screenToWorld(\n      pressPos,\n      camTransform,\n      camera.tilt,\n      camera.zoom,\n    );\n    pf.targetX = worldPos.x;\n    pf.targetY = worldPos.y;\n  });\n}\nfunction handlePathfind(world: World) {\n  world\n    .query({ and: [PathFinder, Transform, Velocity, Stats] })\n    .forEach((e) => {\n      const pf = world.getComponent(e, PathFinder);\n      const p = world.getComponent(e, Transform);\n      const v = world.getComponent(e, Velocity);\n      const s = world.getComponent(e, Stats);\n\n      const dx = pf.targetX - p.x;\n      const dy = pf.targetY - p.y;\n      const dMag = (dx * dx + dy * dy) ** 0.5;\n      if (dMag == 0) return;\n      const controlDistance = s.moveSpeed * Time.dtSeconds * 2;\n      const adjustedSpeed =\n        dMag > controlDistance\n          ? s.moveSpeed\n          : (s.moveSpeed * dMag) / controlDistance;\n      v.x = (dx / dMag) * adjustedSpeed;\n      v.y = (dy / dMag) * adjustedSpeed;\n    });\n}\nfunction handleTimers(world: World) {\n  world.query({ and: [Timer] }).forEach((e) => {\n    const t = world.getComponent(e, Timer);\n    if (t.reset) t.timeMilli = 0;\n    t.reset = false;\n    if (!t.stop) t.timeMilli += Time.dtMilli;\n  });\n}\nfunction handleCallbacks(world: World) {\n  for (const e of world.query({ and: [Callback] })) {\n    const cb = world.getComponent(e, Callback);\n    cb.callback(e);\n  }\n}\nfunction drawTexts(world: World) {\n  const old = Ctx2D.ctx.fillStyle;\n  world.query({ and: [Text, Transform] }).forEach((e) => {\n    const t = world.getComponent(e, Text);\n    const p = world.getComponent(e, Transform);\n    Ctx2D.ctx.font = `${t.fontSize}px serif`;\n    const lines = t.content.split(\"\\n\");\n    Ctx2D.ctx.fillStyle = t.backgroundColor;\n    for (let i = 0, l = lines.length; i < l; i++) {\n      const txtMetric = Ctx2D.ctx.measureText(lines[i]);\n      Ctx2D.ctx.fillRect(\n        p.x,\n        p.y + i * (2 * t.padding) + i * txtMetric.fontBoundingBoxAscent,\n        t.padding * 2 + txtMetric.width,\n        t.padding * 2 + txtMetric.fontBoundingBoxAscent,\n      );\n    }\n    Ctx2D.ctx.fillStyle = t.color;\n    for (let i = 0, l = lines.length; i < l; i++) {\n      const txtMetric = Ctx2D.ctx.measureText(lines[i]);\n      Ctx2D.ctx.fillText(\n        lines[i],\n        p.x + t.padding,\n        p.y + i * (2 * t.padding) + (i + 1) * txtMetric.fontBoundingBoxAscent,\n      );\n    }\n  });\n  Ctx2D.ctx.fillStyle = old;\n}\nfunction drawRects(world: World) {\n  const rects = world.query({ and: [Transform, Rect, Colour, OnScreen] });\n  for (const e of rects) {\n    const p = world.getComponent(e, Transform);\n    const r = world.getComponent(e, Rect);\n    const c = world.getComponent(e, Colour);\n    Ctx2D.ctx.fillStyle = c.stroke;\n    const cos = Math.cos(p.rad);\n    const sin = Math.sin(p.rad);\n    Ctx2D.ctx.transform(cos, sin, -sin, cos, p.x, p.y);\n    Ctx2D.ctx.fillRect(\n      r.x * p.scaleX - 0.5,\n      r.y * p.scaleY - 0.5,\n      r.width * p.scaleX + 1,\n      r.height * p.scaleY + 1,\n    );\n    Ctx2D.ctx.transform(\n      cos,\n      -sin,\n      sin,\n      cos,\n      cos * -p.x + sin * -p.y,\n      -sin * -p.x + cos * -p.y,\n    );\n  }\n  for (const e of rects) {\n    const p = world.getComponent(e, Transform);\n    const r = world.getComponent(e, Rect);\n    const c = world.getComponent(e, Colour);\n    Ctx2D.ctx.fillStyle = c.fill;\n    const cos = Math.cos(p.rad);\n    const sin = Math.sin(p.rad);\n    Ctx2D.ctx.transform(cos, sin, -sin, cos, p.x, p.y);\n    Ctx2D.ctx.fillRect(\n      r.x * p.scaleX,\n      r.y * p.scaleY,\n      r.width * p.scaleX,\n      r.height * p.scaleY,\n    );\n    Ctx2D.ctx.transform(\n      cos,\n      -sin,\n      sin,\n      cos,\n      cos * -p.x + sin * -p.y,\n      -sin * -p.x + cos * -p.y,\n    );\n  }\n}\nfunction drawPathFindTargets(world: World) {\n  const old = Ctx2D.ctx.fillStyle;\n  Ctx2D.ctx.fillStyle = \"red\";\n  world.query({ and: [PathFinder] }).forEach((e) => {\n    const pf = world.getComponent(e, PathFinder);\n    Ctx2D.ctx.fillRect(pf.targetX - 0.5, pf.targetY - 0.5, 1, 1);\n  });\n  Ctx2D.ctx.fillStyle = old;\n}\nfunction handleCamera(world: World) {\n  const camEntity = world\n    .query({ and: [Camera, Transform] })\n    .find((e) => world.getComponent(e, Camera).isActive);\n  if (!camEntity) return;\n  Ctx2D.ctx.resetTransform();\n  const c = world.getComponent(camEntity, Camera);\n  const p = world.getComponent(camEntity, Transform);\n  if (c.targetEntity != -1 && world.hasComponent(c.targetEntity, Transform)) {\n    const targetPos = world.getComponent(c.targetEntity, Transform);\n    Object.assign(p, targetPos);\n  }\n  const sin = Math.sin(c.tilt) * c.zoom;\n  const cos = Math.cos(c.tilt) * c.zoom;\n  Ctx2D.ctx.transform(\n    cos,\n    sin,\n    -sin,\n    cos,\n    cos * -p.x - sin * -p.y + Ctx2D.ctx.canvas.width * 0.5,\n    sin * -p.x + cos * -p.y + Ctx2D.ctx.canvas.height * 0.5,\n  );\n}\nfunction move(world: World) {\n  world.query({ and: [Transform, Velocity] }).forEach((e) => {\n    const p = world.getComponent(e, Transform);\n    const v = world.getComponent(e, Velocity);\n    p.x += v.x * Time.dtSeconds;\n    p.y += v.y * Time.dtSeconds;\n  });\n}\nfunction drawImg(world: World) {\n  world.query({ and: [Graphic, Transform] }).forEach((e) => {\n    const g = world.getComponent(e, Graphic);\n    const p = world.getComponent(e, Transform);\n    const img = g.image;\n    let imgWidth = img.width;\n    let imgHeight = img.height;\n    let offsetX = 0;\n    let offsetY = 0;\n    if (world.hasComponent(e, Rect)) {\n      const r = world.getComponent(e, Rect);\n      imgWidth = r.width;\n      imgHeight = r.height;\n      offsetX = r.x;\n      offsetY = r.y;\n    }\n    const scaleX = imgWidth / img.width;\n    const scaleY = imgHeight / img.height;\n    const c = Math.cos(p.rad);\n    const s = Math.sin(p.rad);\n    Ctx2D.ctx.transform(\n      c * scaleX,\n      s * scaleX,\n      -s * scaleY,\n      c * scaleY,\n      p.x,\n      p.y,\n    );\n    Ctx2D.ctx.drawImage(img, offsetX, offsetY);\n    Ctx2D.ctx.transform(\n      c / scaleX,\n      -s / scaleX,\n      s / scaleY,\n      c / scaleY,\n      (c * -p.x + s * -p.y) / scaleY,\n      (-s * -p.x + c * -p.y) / scaleY,\n    );\n  });\n}\nfunction handleButtons(world: World) {\n  const pressPos = pointerToScreen(Pointer.pressPos, Ctx2D.canvas);\n  const releasePos = pointerToScreen(Pointer.releasePos, Ctx2D.canvas);\n  const pointerPos = pointerToScreen(\n    { x: Pointer.x, y: Pointer.y },\n    Ctx2D.canvas,\n  );\n  world.query({ and: [Button, Transform, Rect] }).forEach((e) => {\n    const p = world.getComponent(e, Transform);\n    const b = world.getComponent(e, Button);\n    const r = world.getComponent(e, Rect);\n    const pressedWithinButton =\n      (pressPos.x - p.x) ** 2 < (r.width / 2) ** 2 &&\n      (pressPos.y - p.y) ** 2 < (r.height / 2) ** 2;\n    b.hovered =\n      (pointerPos.x - p.x) ** 2 < (r.width / 2) ** 2 &&\n      (pointerPos.y - p.y) ** 2 < (r.height / 2) ** 2;\n    b.pressed = b.hovered && Pointer.isDown && pressedWithinButton;\n    b.clicked =\n      Pointer.justReleased &&\n      pressedWithinButton &&\n      (releasePos.x - p.x) ** 2 < (r.width / 2) ** 2 &&\n      (releasePos.y - p.y) ** 2 < (r.height / 2) ** 2;\n  });\n}\nfunction drawHealthBars(world: World) {\n  const widthMult = 1.5;\n  const barHeight = 0.3;\n  const margin = 0.2;\n  const entities = world.query({ and: [OnScreen, Health, Transform, Rect] });\n  Ctx2D.ctx.fillStyle = \"black\";\n  Ctx2D.ctx.beginPath();\n  for (const e of entities) {\n    const t = world.getComponent(e, Transform);\n    const r = world.getComponent(e, Rect);\n    const cos = Math.cos(t.rad);\n    const sin = Math.sin(t.rad);\n    const x = -(r.width * widthMult) / 2;\n    const y = -barHeight / 2 + r.y - 1;\n    Ctx2D.ctx.rect(\n      t.x - margin / 2 + cos * x - sin * y,\n      t.y - margin / 2 + sin * x + cos * y,\n      r.width * widthMult + margin,\n      barHeight + margin,\n    );\n  }\n  Ctx2D.ctx.fill();\n  Ctx2D.ctx.fillStyle = \"green\";\n  Ctx2D.ctx.beginPath();\n  for (const e of entities) {\n    const t = world.getComponent(e, Transform);\n    const r = world.getComponent(e, Rect);\n    const h = world.getComponent(e, Health);\n    const cos = Math.cos(t.rad);\n    const sin = Math.sin(t.rad);\n    const x = -(r.width * widthMult) / 2;\n    const y = -barHeight / 2 + r.y - 1;\n    Ctx2D.ctx.rect(\n      t.x + cos * x - sin * y,\n      t.y + sin * x + cos * y,\n      r.width * widthMult * (h.current / h.max),\n      barHeight,\n    );\n  }\n  Ctx2D.ctx.fill();\n}\n\n// entities\nfunction addSpawners(world: World) {\n  const base = addMinion(world, -152, 152);\n  const pos = [-138, 110, -110, 138, -118, 118];\n  for (let i = 0, l = pos.length; i < l; i += 2) {\n    addSpawner(world, pos[i], pos[i + 1], base);\n    addSpawner(world, -pos[i], -pos[i + 1], base);\n  }\n}\nfunction addMinion(world: World, x: number, y: number): entityT {\n  const e = addRect(world);\n  world.addComponent(e, Transform, { x, y });\n  world.addComponent(e, Health, {\n    current: config.entities.minion.healthPoint,\n    max: config.entities.minion.healthPoint,\n  });\n  return e;\n}\nfunction addSpawner(\n  world: World,\n  x: number,\n  y: number,\n  spawnEntity: entityT,\n): entityT {\n  const e = world.addEntity();\n  world.addComponent(e, Transform, { x, y });\n  world.addComponent(e, ParticleEmitter, {\n    particleLifetimeSeconds: 10,\n    particleEntity: spawnEntity,\n  });\n  world.addComponent(e, Timer);\n  world.addComponent(e, Callback, {\n    callback: (e) => {\n      const timer = world.getComponent(e, Timer);\n      if (timer.timeMilli < 1000 / config.entities.minion.spawnRate) return;\n      timer.reset = true;\n      world.getComponent(e, ParticleEmitter).emit = true;\n    },\n  });\n  return e;\n}\nfunction addTurrents(world: World) {\n  const pos = [\n    -10, 10, -60, 60, -108, 108, -138, 92, -138, 0, -138, -110, -92, 138, 0,\n    138, 110, 138,\n  ];\n  for (let i = 0, l = pos.length; i < l; i += 2) {\n    addTurrent(world, pos[i], pos[i + 1]);\n    addTurrent(world, -pos[i], -pos[i + 1]);\n  }\n}\nfunction addFountains(world: World) {\n  addRect(world, -128, 128, 10, 10);\n  addRect(world, 128, -128, 10, 10);\n}\nfunction addGraphic(world: World, src: string, x = 0, y = 0, w = 1, h = 1) {\n  const e = world.addEntity();\n  world.addComponent(e, Transform, { x, y });\n  const img = new Image();\n  img.src = src;\n  world.addComponent(e, Graphic, { image: img });\n  world.addComponent(e, Rect, { width: w, height: h });\n  return e;\n}\nfunction addRect(\n  world: World,\n  x = 0,\n  y = 0,\n  w = 1,\n  h = 1,\n  offsetX = -w / 2,\n  offsetY = -h / 2,\n) {\n  const e = world.addEntity();\n  world.addComponent(e, Transform, { x, y });\n  world.addComponent(e, Rect, { width: w, height: h, x: offsetX, y: offsetY });\n  world.addComponent(e, Colour);\n  world.addComponent(e, OnScreen);\n  return e;\n}\nfunction addButton(\n  world: World,\n  x = 0,\n  y = 0,\n  w = 10,\n  h = 10,\n  cb = (e: entityT) => {\n    const b = world.getComponent(e, Button);\n    const c = world.getComponent(e, Colour);\n    c.fill = \"grey\";\n    if (b.hovered) {\n      c.fill = \"lightgrey\";\n    }\n    if (b.pressed) {\n      c.fill = \"red\";\n    }\n    if (b.clicked) {\n      c.fill = \"green\";\n    }\n  },\n) {\n  const e = addRect(world, x, y, w, h);\n  world.addComponent(e, Button);\n  world.addComponent(e, Colour);\n  world.addComponent(e, Callback, { callback: cb });\n  world.addComponent(e, Text, {\n    content: \"Button\",\n    backgroundColor: \"transparent\",\n    color: \"white\",\n  });\n  return e;\n}\nfunction addPlayer(world: World, x = 0, y = 0) {\n  const player = addRect(world, x, y, 1, 1);\n  world.addComponent(player, Velocity);\n  world.addComponent(player, Stats, {\n    ...config.entities.player,\n  });\n  world.addComponent(player, Health, {\n    max: config.entities.player.healthPoint,\n    current: config.entities.player.healthPoint,\n  });\n  world.addComponent(player, IsPlayer);\n  world.addComponent(player, PathFinder, { targetX: x, targetY: y });\n  return player;\n}\nfunction addTurrent(world: World, x: number, y: number) {\n  const turrent = addRect(world, x, y, 3, 10, -1.5, -10);\n  world.addComponent(turrent, Stats, { ...config.entities.turrent });\n  world.addComponent(turrent, Health, {\n    max: config.entities.turrent.healthPoint,\n    current: config.entities.turrent.healthPoint,\n  });\n  return turrent;\n}\nfunction addCamera(world: World, x: number, y: number) {\n  const cam = world.addEntity();\n  world.addComponent(cam, Camera, { zoom: 30 });\n  world.addComponent(cam, Transform, { x, y });\n  return cam;\n}\n\n//utils\nfunction drawBg(color: string = \"#424242\") {\n  const old = Ctx2D.ctx.fillStyle;\n  Ctx2D.ctx.fillStyle = color;\n  Ctx2D.ctx.fillRect(0, 0, Ctx2D.canvas.width, Ctx2D.canvas.height);\n  Ctx2D.ctx.fillStyle = old;\n}\nfunction rectsOverlap(\n  cx1: number,\n  cy1: number,\n  w1: number,\n  h1: number,\n  cx2: number,\n  cy2: number,\n  w2: number,\n  h2: number,\n): boolean {\n  return (\n    (cx1 - cx2) ** 2 < ((w1 + w2) / 2) ** 2 &&\n    (cy1 - cy2) ** 2 < ((h1 + h2) / 2) ** 2\n  );\n}\ntype vec2 = { x: number; y: number };\nfunction screenToWorld(\n  pointerPos: vec2,\n  cameraPos: vec2,\n  cameraTilt: number,\n  cameraZoom: number,\n): vec2 {\n  const cos = Math.cos(cameraTilt);\n  const sin = Math.sin(cameraTilt);\n  const res = { x: 0, y: 0 };\n  const x = pointerPos.x - config.viewport.width / 2;\n  const y = pointerPos.y - config.viewport.height / 2;\n  res.x = cos * x + sin * y;\n  res.y = -sin * x + cos * y;\n  res.x /= cameraZoom;\n  res.y /= cameraZoom;\n  res.x += cameraPos.x;\n  res.y += cameraPos.y;\n  return res;\n}\nfunction worldToScreen(\n  pos: vec2,\n  cameraPos: vec2,\n  cameraTilt: number,\n  cameraZoom: number,\n): vec2 {\n  const c = Math.cos(cameraTilt);\n  const s = Math.sin(cameraTilt);\n  const res = { x: 0, y: 0 };\n  let x = pos.x - cameraPos.x;\n  let y = pos.y - cameraPos.y;\n  x *= cameraZoom;\n  y *= cameraZoom;\n  res.x = c * x - s * y;\n  res.y = s * x + c * y;\n  res.x += config.viewport.width * 0.5;\n  res.y += config.viewport.height * 0.5;\n  return res;\n}\n// credit: https://www.30secondsofcode.org/js/s/detect-device-type/\nfunction detectDeviceType(): string {\n  return /Mobile|Android|iPhone|iPad/i.test(navigator.userAgent)\n    ? \"Mobile\"\n    : \"Desktop\";\n}\nfunction pointerToScreen(pointer: vec2, canvas: HTMLCanvasElement): vec2 {\n  const out = { x: 0, y: 0 };\n  const rect = canvas.getBoundingClientRect();\n  out.x = pointer.x - rect.left;\n  out.y = pointer.y - rect.top;\n  if (innerWidth / innerHeight < canvas.width / canvas.height) {\n    out.x *= canvas.width / innerWidth;\n    out.y *= canvas.width / innerWidth;\n  } else {\n    out.x *= canvas.height / innerHeight;\n    out.y *= canvas.height / innerHeight;\n  }\n  return out;\n}\n\n// initialization\nCtx2D.canvas.width = config.viewport.width;\nCtx2D.canvas.height = config.viewport.height;\n// Ctx2D.canvas.style.imageRendering = \"pixelated\";\nCtx2D.ctx.lineWidth = 0.1;\n\nconst game = new World();\n\naddPlayer(game, -146, 146);\naddTurrents(game);\naddFountains(game);\naddSpawners(game);\n\naddGraphic(game, \"./assets/Map_of_MOBA.svg\", -150, -150, 300, 300);\n\nconst cam = addCamera(game, 0, 0);\nconst camComponent = game.getComponent(cam, Camera);\ncamComponent.targetEntity = game.query({ and: [IsPlayer] })[0];\ncamComponent.isActive = true;\ncamComponent.zoom = 15;\n\nconst cleaner = game.addEntity();\ngame.addComponent(cleaner, Timer);\ngame.addComponent(cleaner, Callback, {\n  callback: (e: entityT) => {\n    const t = game.getComponent(e, Timer);\n    if (t.timeMilli < 1000 * 60 * 5) return;\n    t.reset = true;\n    game.cleanObjectPools();\n  },\n});\n\nconst inGameUi = new World();\n\naddButton(\n  inGameUi,\n  config.viewport.width * 0.9,\n  config.viewport.height * 0.8,\n  config.viewport.height * 0.3,\n  config.viewport.height * 0.3,\n);\n\nconst debugTextEntity = inGameUi.addEntity();\nconst debugText = inGameUi.addComponent(debugTextEntity, Text, {\n  content: \"test string\",\n  backgroundColor: \"white\",\n});\ninGameUi.addComponent(debugTextEntity, Transform);\n\n{\n  (function update() {\n    requestAnimationFrame(update);\n\n    const player = game.query({ and: [IsPlayer] })[0];\n    game.getComponent(player, Health).current *= 0.99 ** Time.timeSeconds;\n    const playerTransform = game.getComponent(player, Transform);\n    debugText.content = `FPS: ${Math.ceil(1000 / Time.dtMilli)}\\nEntity count: ${game.entityCount()}\\nDevice type: ${detectDeviceType()}\\nPos: (${Math.floor(playerTransform.x)}, ${Math.floor(playerTransform.y)})`;\n\n    // drawing\n    drawBg();\n    game.update(\n      handleCamera,\n      checkOnScreenEntities,\n      drawImg,\n      drawRects,\n      // drawPathFindTargets,\n      drawHealthBars,\n    );\n    Ctx2D.ctx.resetTransform();\n    inGameUi.update(drawImg, drawRects, drawTexts);\n\n    // processing\n    inGameUi.update(handleButtons, handleCallbacks);\n    game.update(\n      handleParticleEmitters,\n      handlePathfind,\n      handleInput,\n      handleTimers,\n      handleCallbacks,\n      move,\n    );\n\n    updatePointer(Pointer);\n    updateKeyboard(Keys);\n    updateTime(Time);\n  })();\n}\n"],
  "mappings": "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",
  "names": ["ObjectPoolMap", "objectFactory", "key", "index", "backKey", "temp", "ComponentManager", "component", "ObjectPoolMap", "mask", "entity", "entry", "src", "dest", "newEntity", "World", "ComponentManager", "entity", "newEntity", "src", "dest", "entry", "compId", "a", "component", "values", "cem", "fns", "i", "l", "query", "res", "comp", "config_default", "Stats", "Health", "Callback", "_", "Transform", "Velocity", "IsPlayer", "OnScreen", "ParticleEmitter", "world", "particleEntity", "percentageLifeTime", "t", "Camera", "Rect", "Graphic", "Button", "Colour", "Text", "Timer", "PathFinder", "Ctx2D", "setUpCanvas2D", "Pointer", "setUpPointer", "Keys", "setUpKeyboard", "Time", "setUpTime", "canvas", "ctx", "keys", "updateKeyboard", "key", "pointer", "updatePointer", "updateTime", "time", "checkOnScreenEntities", "camEntity", "e", "cam", "camTransform", "r", "rectsOverlap", "handleParticleEmitters", "world", "ParticleEmitter", "Transform", "emitter", "t", "particle", "timer", "Timer", "rad", "Velocity", "Callback", "handleInput", "camEntity", "Camera", "e", "camera", "camTransform", "pressPos", "pointerToScreen", "Pointer", "Ctx2D", "PathFinder", "IsPlayer", "pf", "worldPos", "screenToWorld", "handlePathfind", "Stats", "p", "v", "s", "dx", "dy", "dMag", "controlDistance", "Time", "adjustedSpeed", "handleTimers", "handleCallbacks", "drawTexts", "old", "Text", "lines", "l", "txtMetric", "drawRects", "rects", "Rect", "Colour", "OnScreen", "r", "c", "cos", "sin", "handleCamera", "world", "camEntity", "Camera", "Transform", "e", "Ctx2D", "c", "p", "targetPos", "sin", "cos", "move", "Velocity", "v", "Time", "drawImg", "Graphic", "g", "img", "imgWidth", "imgHeight", "offsetX", "offsetY", "Rect", "r", "scaleX", "scaleY", "s", "handleButtons", "pressPos", "pointerToScreen", "Pointer", "releasePos", "pointerPos", "Button", "b", "pressedWithinButton", "drawHealthBars", "entities", "OnScreen", "Health", "t", "x", "y", "addSpawners", "base", "addMinion", "pos", "i", "l", "addSpawner", "addRect", "config_default", "spawnEntity", "ParticleEmitter", "Timer", "Callback", "timer", "addTurrents", "addTurrent", "addFountains", "addGraphic", "src", "w", "h", "Colour", "addButton", "cb", "Text", "addPlayer", "player", "Stats", "IsPlayer", "PathFinder", "turrent", "addCamera", "cam", "drawBg", "color", "old", "rectsOverlap", "cx1", "cy1", "w1", "h1", "cx2", "cy2", "w2", "h2", "screenToWorld", "cameraPos", "cameraTilt", "cameraZoom", "res", "detectDeviceType", "pointerToScreen", "pointer", "canvas", "out", "rect", "Ctx2D", "config_default", "game", "World", "addPlayer", "addTurrents", "addFountains", "addSpawners", "addGraphic", "cam", "addCamera", "camComponent", "Camera", "IsPlayer", "cleaner", "Timer", "Callback", "e", "t", "inGameUi", "addButton", "debugTextEntity", "debugText", "Text", "Transform", "update", "player", "Health", "Time", "playerTransform", "drawBg", "handleCamera", "checkOnScreenEntities", "drawImg", "drawRects", "drawHealthBars", "drawTexts", "handleButtons", "handleCallbacks", "handleParticleEmitters", "handlePathfind", "handleInput", "handleTimers", "move", "updatePointer", "Pointer", "updateKeyboard", "Keys", "updateTime"]
}
