{
  "version": 3,
  "sources": ["../../../src/pool.ts", "../../../src/component.ts", "../../../src/entity.ts", "../../../src/world.ts", "../src/main.ts"],
  "sourcesContent": ["export class ObjectPoolMap<K, V> {\n  private storage: Map<K, V> = new Map();\n  private freeKeys: Set<K> = new Set();\n  private count = 0;\n  private objectFactory: () => V;\n\n  constructor(objectFactory: () => V) {\n    this.objectFactory = objectFactory;\n  }\n\n  size(): number {\n    return this.count;\n  }\n\n  add(key: K): V {\n    if (this.has(key)) {\n      return this.storage.get(key) as V;\n    }\n    let value: V | undefined;\n    let freeKey: K | undefined;\n    if (this.freeKeys.has(key)) {\n      freeKey = key;\n    } else {\n      for (const k of this.freeKeys) {\n        freeKey = k;\n        break;\n      }\n    }\n    if (freeKey != undefined) {\n      this.freeKeys.delete(freeKey);\n      value = this.storage.get(freeKey);\n      this.storage.delete(freeKey);\n    }\n    value = value == undefined ? this.objectFactory() : value;\n    this.storage.set(key, value);\n    this.count++;\n    return value;\n  }\n\n  remove(key: K): void {\n    if (!this.has(key)) return;\n    this.freeKeys.add(key);\n    this.count--;\n  }\n\n  get(key: K): V {\n    const value = this.storage.get(key);\n    if (value == undefined) throw new Error(\"Key not found.\");\n    return value;\n  }\n\n  has(key: K): boolean {\n    return this.storage.has(key) && !this.freeKeys.has(key);\n  }\n\n  clean(): void {\n    for (const value of this.freeKeys) {\n      this.storage.delete(value);\n    }\n    this.freeKeys.clear();\n  }\n}\nexport class ObjectPoolMapOld<K, V> {\n  private storage: V[] = [];\n  private keyToIndex: Map<K, number> = new Map();\n  private indexToKey: K[] = [];\n  private objectFactory: () => V;\n\n  constructor(objectFactory: () => V) {\n    this.objectFactory = objectFactory;\n  }\n\n  size() {\n    return this.keyToIndex.size;\n  }\n\n  add(key: K): V {\n    if (this.keyToIndex.has(key))\n      return this.storage[this.keyToIndex.get(key) as number];\n    if (this.storage.length <= this.keyToIndex.size)\n      this.storage.push(this.objectFactory());\n    this.keyToIndex.set(key, this.keyToIndex.size);\n    this.indexToKey[this.keyToIndex.size - 1] = key;\n    return this.storage[this.keyToIndex.get(key) as number];\n  }\n\n  remove(key: K): void {\n    const index = this.keyToIndex.get(key);\n    if (index == undefined) return;\n    const backKey = this.indexToKey[this.keyToIndex.size - 1];\n    const temp = this.storage[index];\n    this.storage[index] = this.storage[this.keyToIndex.size - 1];\n    this.storage[this.keyToIndex.size - 1] = temp;\n    this.indexToKey[index] = backKey;\n    this.indexToKey.pop();\n    this.keyToIndex.set(backKey, index);\n    this.keyToIndex.delete(key);\n  }\n\n  get(key: K): V {\n    const index = this.keyToIndex.get(key);\n    if (index == undefined) throw new Error(\"Key not found.\");\n    return this.storage[index];\n  }\n\n  has(key: K): boolean {\n    return this.keyToIndex.has(key);\n  }\n\n  clean(): void {\n    this.storage.splice(this.keyToIndex.size);\n  }\n}\n", "import { ObjectPoolMap } from \"./pool.ts\";\nimport { entityT } from \"./entity.ts\";\n\nexport class ComponentManager {\n  private poolMap: Map<object, ObjectPoolMap<entityT, object>> = new Map();\n  private maskMap: Map<object, number> = new Map();\n\n  register<T extends object>(component: T): void {\n    if (this.poolMap.has(component)) return;\n    this.maskMap.set(component, 1 << this.maskMap.size);\n    this.poolMap.set(\n      component,\n      new ObjectPoolMap<entityT, T>(() => ({ ...component })),\n    );\n  }\n\n  getMask<T extends object>(component: T): number {\n    return this.maskMap.get(component) ?? -1;\n  }\n\n  add<T extends object>(entity: entityT, component: T): T {\n    return Object.assign(\n      (this.poolMap.get(component) as ObjectPoolMap<entityT, T>).add(entity),\n      component,\n    );\n  }\n\n  remove<T extends object>(entity: entityT, component: T): void {\n    (this.poolMap.get(component) as ObjectPoolMap<entityT, T>).remove(entity);\n  }\n\n  has<T extends object>(entity: entityT, component: T): boolean {\n    return (\n      this.poolMap.has(component) &&\n      (this.poolMap.get(component) as ObjectPoolMap<entityT, T>).has(entity)\n    );\n  }\n\n  get<T extends object>(entity: entityT, component: T): T {\n    return (this.poolMap.get(component) as ObjectPoolMap<entityT, T>).get(\n      entity,\n    );\n  }\n\n  size<T extends object>(component: T): number {\n    return (this.poolMap.get(component) as ObjectPoolMap<entityT, T>).size();\n  }\n\n  delete(entity: entityT): void {\n    for (const entry of this.poolMap.entries()) entry[1].remove(entity);\n  }\n\n  copy(src: entityT, dest: entityT): void {\n    for (const entry of this.poolMap.entries())\n      entry[1].has(src) && Object.assign(entry[1].add(dest), entry[1].get(src));\n  }\n\n  clean(): void {\n    for (const entry of this.poolMap.entries()) entry[1].clean();\n  }\n}\n", "export type entityT = number;\nexport function newEntity(): entityT {\n  return Math.random();\n}\n", "import { ComponentManager } from \"./component.ts\";\nimport { newEntity, type entityT } from \"./entity.ts\";\n\nexport type queryT = Partial<Record<\"and\" | \"not\", object[]>>;\n\nexport type systemT = (world: World) => void;\n\nexport class World {\n  private maskMap: Map<entityT, number> = new Map();\n  private archetypeMap: Map<number, Set<entityT>> = new Map();\n  private compManager = new ComponentManager();\n\n  addEntity(entity: entityT = newEntity()): entityT {\n    if (this.maskMap.has(entity)) return entity;\n    this.maskMap.set(entity, 0);\n    return entity;\n  }\n\n  copyEntity(src: entityT, dest: entityT = newEntity()): entityT {\n    this.compManager.copy(src, dest);\n    const mask = this.maskMap.get(src) ?? 0;\n    this.maskMap.set(dest, mask);\n    this.getArchetype(mask).add(dest);\n    return dest;\n  }\n\n  private getArchetype(mask: number): Set<entityT> {\n    const a = this.archetypeMap.get(mask) ?? new Set();\n    this.archetypeMap.set(mask, a);\n    return a;\n  }\n\n  deleteEntity(entity: entityT) {\n    this.compManager.delete(entity);\n    this.getArchetype(this.maskMap.get(entity) ?? 0).delete(entity);\n    this.maskMap.delete(entity);\n  }\n\n  registerComponent<T extends object>(component: T): World {\n    this.compManager.register(component);\n    return this;\n  }\n\n  hasComponent<T extends object>(entity: entityT, component: T): boolean {\n    return this.compManager.has(entity, component);\n  }\n\n  addComponent<T extends object>(\n    entity: entityT,\n    component: T,\n    values: Partial<T> = component,\n  ): T {\n    this.compManager.register(component);\n    let mask = this.maskMap.get(entity) ?? 0;\n    const compMask = this.compManager.getMask(component);\n    if (mask & compMask)\n      return Object.assign(this.compManager.get(entity, component), values);\n    this.getArchetype(mask).delete(entity);\n    mask ^= compMask;\n    this.maskMap.set(entity, mask);\n    this.getArchetype(mask).add(entity);\n    return Object.assign(this.compManager.add(entity, component), values);\n  }\n\n  removeComponent<T extends object>(entity: entityT, component: T): void {\n    this.compManager.register(component);\n    let mask = this.maskMap.get(entity) ?? 0;\n    const compMask = this.compManager.getMask(component);\n    if ((mask & compMask) ^ compMask) return;\n    this.compManager.remove(entity, component);\n    this.getArchetype(mask).delete(entity);\n    mask ^= compMask;\n    this.maskMap.set(entity, mask);\n    this.getArchetype(mask).add(entity);\n  }\n\n  getComponent<T extends object>(entity: entityT, component: T): T {\n    return this.compManager.get(entity, component);\n  }\n\n  update(...fns: systemT[]) {\n    for (let i = 0, l = fns.length; i < l; i++) fns[i](this);\n  }\n\n  cleanObjectPools(): void {\n    this.compManager.clean();\n  }\n\n  query(query: queryT): entityT[] {\n    let andMask = 0,\n      notMask = 0;\n    if (query.and) {\n      for (let i = 0, l = query.and.length; i < l; i++)\n        andMask |= this.compManager.getMask(query.and[i]);\n    }\n    if (query.not) {\n      for (let i = 0, l = query.not.length; i < l; i++)\n        notMask |= this.compManager.getMask(query.not[i]);\n    }\n    const res: entityT[] = [];\n    for (const entry of this.archetypeMap.entries()) {\n      entry[1].size > 0 &&\n        (entry[0] & andMask) == andMask &&\n        (entry[0] & notMask) == 0 &&\n        res.push(...entry[1]);\n    }\n    return res;\n  }\n\n  entityCount(): number {\n    return this.maskMap.size;\n  }\n}\n", "import { entityT, World } from \"bozoecs\";\n\n// singletons\nconst Ctx2D = setUpCanvas2D();\nconst Time = setUpTime();\nconst Pointer = setUpPointer();\n\nfunction setUpCanvas2D() {\n  const canvas =\n    document.querySelector(\"canvas\") ?? document.createElement(\"canvas\");\n  if (!canvas) throw new Error(\"Cannot create canvas element.\");\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) throw new Error(\"Cannot initialize context 2d.\");\n\n  document.body.appendChild(canvas);\n\n  globalThis.onresize = globalThis.onload = () => {\n    if (innerWidth / innerHeight < canvas.width / canvas.height) {\n      canvas.style.width = \"100%\";\n      canvas.style.height = \"\";\n    } else {\n      canvas.style.width = \"\";\n      canvas.style.height = \"100%\";\n    }\n  };\n\n  return { canvas, ctx };\n}\nfunction setUpTime() {\n  return { dtMilli: 0, timeMilli: 0 };\n}\nfunction updateTime(time: { dtMilli: number; timeMilli: number }) {\n  time.dtMilli = performance.now() - time.timeMilli;\n  time.timeMilli += time.dtMilli;\n}\ntype pointerT = {\n  pos: Map<number, vec2>;\n  isDown: Map<number, boolean>;\n  justPressed: Map<number, boolean>;\n  justReleased: Map<number, boolean>;\n  pressPos: Map<number, vec2>;\n  releasePos: Map<number, vec2>;\n};\nfunction setUpPointer() {\n  const pointer: pointerT = {\n    pos: new Map(),\n    isDown: new Map(),\n    justPressed: new Map(),\n    justReleased: new Map(),\n    pressPos: new Map(),\n    releasePos: new Map(),\n  };\n\n  globalThis.onpointerdown = (e) => {\n    if (!(e.target instanceof HTMLCanvasElement)) return;\n    pointer.pos.set(e.pointerId, { x: e.x, y: e.y });\n    pointer.pressPos.set(e.pointerId, { x: e.x, y: e.y });\n    pointer.isDown.set(e.pointerId, true);\n    pointer.justPressed.set(e.pointerId, true);\n  };\n\n  globalThis.onpointerup = (e) => {\n    pointer.pos.delete(e.pointerId);\n    pointer.releasePos.set(e.pointerId, { x: e.x, y: e.y });\n    pointer.isDown.delete(e.pointerId);\n    pointer.justReleased.set(e.pointerId, true);\n  };\n\n  globalThis.onpointermove = (e) => {\n    pointer.pos.set(e.pointerId, { x: e.x, y: e.y });\n  };\n\n  return pointer;\n}\nfunction updatePointer(pointer: pointerT) {\n  pointer.justReleased.clear();\n  pointer.justPressed.clear();\n  pointer.releasePos.clear();\n  pointer.pressPos.clear();\n}\n\n// components\nconst Transform = { x: 0, y: 0, rad: 0 };\nconst Hierarchy: { parent: entityT; children: entityT[] } = {\n  parent: -1,\n  children: [],\n};\nconst Eye = { eyeWhiteRadius: 1, pupilRadius: 0.4, lookAtEntity: -1 };\nconst Camera = { zoom: 20, tilt: 0, isActive: false };\nconst Rect = { width: 1, height: 1 };\nconst Material = { density: 0.1 };\nconst Velocity = { x: 0, y: 0 };\nconst Acceleration = { x: 0, y: 0 };\nconst isPointer = {};\nconst AngularVelocity = { radPerSecond: 0 };\n\n// entities\nfunction addLimb(\n  world: World,\n  x = 0,\n  y = 0,\n  rect: typeof Rect = { width: 1, height: 1 },\n  offset: vec2 = { x: 0, y: 0 },\n  parent = -1,\n) {\n  const anchor = world.addEntity();\n  world.addComponent(anchor, Transform, { x, y });\n  world.addComponent(anchor, Velocity);\n  world.addComponent(anchor, Acceleration);\n  world.addComponent(anchor, AngularVelocity);\n  const limb = world.addEntity();\n  world.addComponent(limb, Transform, offset);\n  world.addComponent(limb, Rect, rect);\n  world.addComponent(limb, Material);\n  attach(world, parent, anchor);\n  attach(world, anchor, limb);\n  return anchor;\n}\nfunction addEye(\n  world: World,\n  x = 0,\n  y = 0,\n  eyeWhiteRadius = 1,\n  pupilRadius = 0.4,\n  lookAtEntity = -1,\n  parent = -1,\n) {\n  const eye = world.addEntity();\n  world.addComponent(eye, Transform, { x, y });\n  world.addComponent(eye, Hierarchy, { parent });\n  world.addComponent(eye, Eye, { eyeWhiteRadius, pupilRadius, lookAtEntity });\n  return eye;\n}\nfunction addPerson(world: World, x = 0, y = 0, lookAtEntity = -1) {\n  const headRect: typeof Rect = { width: 1, height: 1 };\n  const headOffset: vec2 = { x: -0.5, y: 0 };\n  const torsoRect: typeof Rect = { width: 1, height: 2 };\n  const torsoOffset: vec2 = { x: -0.5, y: -2 };\n  const limbRect: typeof Rect = { width: 0.5, height: 0.9 };\n  const limbOffset: vec2 = { x: -0.25, y: -0.9 };\n\n  const torso = addLimb(world, x, y, torsoRect, torsoOffset);\n  const head = addLimb(world, 0, 0.2, headRect, headOffset, torso);\n  const leftEye = addEye(world, 0.4, 0.4, 0.3, 0.1, lookAtEntity, head);\n  const rightEye = addEye(world, -0.4, 0.4, 0.3, 0.1, lookAtEntity, head);\n  const leftUpperArm = addLimb(world, 1, 0, limbRect, limbOffset, torso);\n  const leftLowerArm = addLimb(\n    world,\n    0,\n    -1,\n    limbRect,\n    limbOffset,\n    leftUpperArm,\n  );\n  const rightUpperArm = addLimb(world, -1, 0, limbRect, limbOffset, torso);\n  const rightLowerArm = addLimb(\n    world,\n    0,\n    -1,\n    limbRect,\n    limbOffset,\n    rightUpperArm,\n  );\n  const leftUpperLeg = addLimb(world, 0.5, -2.2, limbRect, limbOffset, torso);\n  const leftLowerLeg = addLimb(\n    world,\n    0,\n    -1,\n    limbRect,\n    limbOffset,\n    leftUpperLeg,\n  );\n  const rightUpperLeg = addLimb(world, -0.5, -2.2, limbRect, limbOffset, torso);\n  const rightLowerLeg = addLimb(\n    world,\n    0,\n    -1,\n    limbRect,\n    limbOffset,\n    rightUpperLeg,\n  );\n  return {\n    head,\n    rightEye,\n    leftEye,\n    torso,\n    rightUpperArm,\n    rightLowerArm,\n    leftUpperArm,\n    leftLowerArm,\n    rightUpperLeg,\n    rightLowerLeg,\n    leftUpperLeg,\n    leftLowerLeg,\n  };\n}\n\n// systems\nfunction handleAngularVelocity(world: World) {\n  world.query({ and: [Transform, AngularVelocity] }).forEach((e) => {\n    const t = world.getComponent(e, Transform);\n    const av = world.getComponent(e, AngularVelocity);\n    t.rad += (av.radPerSecond * Time.dtMilli) / 1000;\n  });\n}\nfunction handleDrawRects(world: World) {\n  Ctx2D.ctx.beginPath();\n  world.query({ and: [Transform, Rect] }).forEach((e) => {\n    const { x, y, rad: r } = calculateHierarchyTransform(world, e);\n    const rect = world.getComponent(e, Rect);\n    const c = Math.cos(r);\n    const s = Math.sin(r);\n    Ctx2D.ctx.transform(c, s, -s, c, x, y);\n    Ctx2D.ctx.rect(0, 0, rect.width, rect.height);\n    Ctx2D.ctx.transform(c, -s, s, c, c * -x + s * -y, -s * -x + c * -y);\n  });\n  Ctx2D.ctx.fillStyle = \"white\";\n  Ctx2D.ctx.fill();\n}\nfunction handleDrawEyes(world: World) {\n  world.query({ and: [Transform, Eye, Hierarchy] }).forEach((e) => {\n    const eye = world.getComponent(e, Eye);\n    const { x, y } = calculateHierarchyTransform(world, e);\n    Ctx2D.ctx.fillStyle = \"lightgrey\";\n    Ctx2D.ctx.beginPath();\n    Ctx2D.ctx.ellipse(\n      x,\n      y,\n      eye.eyeWhiteRadius,\n      eye.eyeWhiteRadius,\n      0,\n      0,\n      Math.PI * 2,\n    );\n    Ctx2D.ctx.fill();\n    let dirX = 0;\n    let dirY = 0;\n    let mag = eye.eyeWhiteRadius - eye.pupilRadius;\n    if (eye.lookAtEntity != -1) {\n      const t = world.getComponent(eye.lookAtEntity, Transform);\n      dirX = t.x - x;\n      dirY = t.y - y;\n      const m = (dirX ** 2 + dirY ** 2) ** 0.5;\n      dirX /= m;\n      dirY /= m;\n      mag = Math.min(m, mag);\n    }\n    Ctx2D.ctx.fillStyle = \"black\";\n    Ctx2D.ctx.beginPath();\n    Ctx2D.ctx.ellipse(\n      x + dirX * mag,\n      y + dirY * mag,\n      eye.pupilRadius,\n      eye.pupilRadius,\n      0,\n      0,\n      Math.PI * 2,\n    );\n    Ctx2D.ctx.fill();\n  });\n}\nfunction handleCamera(world: World) {\n  const camEntity = world\n    .query({ and: [Camera, Transform] })\n    .find((e) => world.getComponent(e, Camera).isActive);\n  if (!camEntity) return;\n  Ctx2D.ctx.resetTransform();\n  const c = world.getComponent(camEntity, Camera);\n  const p = world.getComponent(camEntity, Transform);\n  if (world.hasComponent(camEntity, Hierarchy)) {\n    const h = world.getComponent(camEntity, Hierarchy);\n    if (world.hasComponent(h.parent, Transform)) {\n      Object.assign(p, calculateHierarchyTransform(world, h.parent));\n    }\n  }\n  const sin = Math.sin(p.rad + c.tilt);\n  const cos = Math.cos(p.rad + c.tilt);\n  const x = p.x * c.zoom;\n  const y = p.y * -c.zoom;\n  Ctx2D.ctx.transform(\n    cos,\n    sin,\n    -sin,\n    cos,\n    cos * -x - sin * -y + Ctx2D.canvas.width * 0.5,\n    sin * -x + cos * -y + Ctx2D.canvas.height * 0.5,\n  );\n  Ctx2D.ctx.transform(c.zoom, 0, 0, -c.zoom, 0, 0);\n}\nfunction handleGravity(world: World) {\n  world.query({ and: [Acceleration] }).forEach((e) => {\n    const a = world.getComponent(e, Acceleration);\n    if (world.hasComponent(e, Hierarchy)) {\n      const h = world.getComponent(e, Hierarchy);\n      if (h.parent != -1) return;\n    }\n    a.y = -9.81;\n  });\n}\nfunction handleMovement(world: World) {\n  world.query({ and: [Velocity, Acceleration] }).forEach((e) => {\n    const v = world.getComponent(e, Velocity);\n    const a = world.getComponent(e, Acceleration);\n    v.x += (a.x * Time.dtMilli) / 1000;\n    v.y += (a.y * Time.dtMilli) / 1000;\n  });\n  world.query({ and: [Transform, Velocity] }).forEach((e) => {\n    const t = world.getComponent(e, Transform);\n    const v = world.getComponent(e, Velocity);\n    t.x += (v.x * Time.dtMilli) / 1000;\n    t.y += (v.y * Time.dtMilli) / 1000;\n  });\n}\nfunction handlePointer(world: World) {\n  world.query({ and: [isPointer] }).forEach((e) => world.deleteEntity(e));\n  const cam = world\n    .query({ and: [Camera, Transform] })\n    .find((e) => world.getComponent(e, Camera).isActive);\n  if (!cam) return;\n  const camComp = world.getComponent(cam, Camera);\n  const camPos = world.getComponent(cam, Transform);\n  Pointer.isDown.forEach((_, k) => {\n    const pointerEntity = world.addEntity();\n    const pos = Pointer.pos.get(k);\n    if (!pos) return;\n    world.addComponent(\n      pointerEntity,\n      Transform,\n      screenToWorld(\n        pointerToScreen(pos, Ctx2D.canvas, true),\n        camPos,\n        camComp.tilt,\n        camComp.zoom,\n      ),\n    );\n    world.addComponent(pointerEntity, isPointer);\n    world.addComponent(pointerEntity, Rect);\n  });\n}\nfunction handleLookAtPointer(world: World) {\n  world.query({ and: [Eye, Transform] }).forEach((e) => {\n    const eye = world.getComponent(e, Eye);\n    const { x, y } = calculateHierarchyTransform(world, e);\n    let pointerRect = -1;\n    let minDistance = Number.POSITIVE_INFINITY;\n    world.query({ and: [isPointer, Transform] }).forEach((e) => {\n      const t = world.getComponent(e, Transform);\n      const dx = t.x - x;\n      const dy = t.y - y;\n      const distance = (dx ** 2 + dy ** 2) ** 0.5;\n      if (distance > minDistance) return;\n      minDistance = distance;\n      pointerRect = e;\n    });\n    eye.lookAtEntity = pointerRect ?? -1;\n  });\n}\n\n// utils\nfunction drawBackground(color = \"#202020\") {\n  Ctx2D.ctx.resetTransform();\n  Ctx2D.ctx.fillStyle = color;\n  Ctx2D.ctx.fillRect(0, 0, Ctx2D.canvas.width, Ctx2D.canvas.height);\n}\ntype vec2 = { x: number; y: number };\nfunction screenToWorld(\n  screenPos: vec2,\n  cameraPos: vec2,\n  cameraTilt: number,\n  cameraZoom: number,\n): vec2 {\n  const cos = Math.cos(cameraTilt);\n  const sin = Math.sin(cameraTilt);\n  const res = { x: 0, y: 0 };\n  const x = screenPos.x - Ctx2D.canvas.width / 2;\n  const y = screenPos.y - Ctx2D.canvas.height / 2;\n  res.x = cos * x - sin * y;\n  res.y = sin * x + cos * y;\n  res.x /= cameraZoom;\n  res.y /= cameraZoom;\n  res.x += cameraPos.x;\n  res.y += cameraPos.y;\n  return res;\n}\nfunction pointerToScreen(\n  pointerPos: vec2,\n  canvas: HTMLCanvasElement,\n  invertY: boolean = false,\n): vec2 {\n  const out = { x: 0, y: 0 };\n  const rect = canvas.getBoundingClientRect();\n  out.x = pointerPos.x - rect.left;\n  out.y = pointerPos.y - rect.top;\n  if (innerWidth / innerHeight < canvas.width / canvas.height) {\n    out.x *= canvas.width / innerWidth;\n    out.y *= canvas.width / innerWidth;\n  } else {\n    out.x *= canvas.height / innerHeight;\n    out.y *= canvas.height / innerHeight;\n  }\n  if (invertY) out.y = -out.y + canvas.height;\n  return out;\n}\nfunction calculateHierarchyTransform(\n  world: World,\n  entity: entityT,\n): typeof Transform {\n  const t = world.getComponent(entity, Transform);\n  if (!world.hasComponent(entity, Hierarchy)) return t;\n  let x = t.x;\n  let y = t.y;\n  let r = t.rad;\n  let h = world.getComponent(entity, Hierarchy);\n  while (world.hasComponent(h.parent, Hierarchy)) {\n    if (world.hasComponent(h.parent, Transform)) {\n      const parentTransform = world.getComponent(h.parent, Transform);\n      const c = Math.cos(parentTransform.rad);\n      const s = Math.sin(parentTransform.rad);\n      const _x = x;\n      const _y = y;\n      x = c * _x - s * _y;\n      y = s * _x + c * _y;\n      x += parentTransform.x;\n      y += parentTransform.y;\n      r += parentTransform.rad;\n    }\n    h = world.getComponent(h.parent, Hierarchy);\n  }\n  return { x, y, rad: r };\n}\nfunction attach(world: World, parent: entityT, child: entityT) {\n  if (parent != -1) {\n    !world.hasComponent(parent, Hierarchy) &&\n      world.addComponent(parent, Hierarchy, { children: [] });\n    const hp = world.getComponent(parent, Hierarchy);\n    for (let i = 0, l = hp.children.length; i < l; i++) {\n      if (hp.children[i] == child) return;\n    }\n    hp.children.push(child);\n  }\n  !world.hasComponent(child, Hierarchy) &&\n    world.addComponent(child, Hierarchy, { children: [] });\n  const hc = world.getComponent(child, Hierarchy);\n  hc.parent = parent;\n}\nfunction detach(world: World, parent: entityT, child: entityT) {\n  if (parent != -1) {\n    !world.hasComponent(parent, Hierarchy) &&\n      world.addComponent(parent, Hierarchy, { children: [] });\n    const hp = world.getComponent(parent, Hierarchy);\n    for (let i = 0, l = hp.children.length; i < l; i++) {\n      if (hp.children[i] != child) continue;\n      hp.children.splice(i, 1);\n      break;\n    }\n  }\n  !world.hasComponent(child, Hierarchy) &&\n    world.addComponent(child, Hierarchy, { children: [] });\n  const hc = world.getComponent(child, Hierarchy);\n  hc.parent = -1;\n}\n\n// initialization\nconst game = new World();\n\nconst player = addPerson(game, 0, 0);\ngame.getComponent(player.rightUpperLeg, AngularVelocity).radPerSecond = 2;\ngame.getComponent(player.rightLowerLeg, AngularVelocity).radPerSecond = -2;\ngame.getComponent(player.leftLowerArm, AngularVelocity).radPerSecond = -1;\n// addPerson(game, -3, 1);\n// addPerson(game, 3, 0);\n\nconst camera = game.addEntity();\ngame.addComponent(camera, Transform, { x: 0, y: 0 });\ngame.addComponent(camera, Camera, {\n  zoom: 18,\n  isActive: true,\n});\ngame.addComponent(camera, Hierarchy, { parent: player.torso });\n\n{\n  (function update() {\n    requestAnimationFrame(update);\n    drawBackground();\n    game.update(\n      handleCamera,\n      handlePointer,\n      handleLookAtPointer,\n      handleDrawRects,\n      handleDrawEyes,\n      // handleGravity,\n      handleMovement,\n      handleAngularVelocity,\n    );\n    updateTime(Time);\n    updatePointer(Pointer);\n  })();\n}\n"],
  "mappings": "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",
  "names": ["ObjectPoolMap", "objectFactory", "key", "value", "freeKey", "k", "ComponentManager", "component", "ObjectPoolMap", "entity", "entry", "src", "dest", "newEntity", "World", "ComponentManager", "entity", "newEntity", "src", "dest", "mask", "a", "component", "values", "compMask", "fns", "i", "l", "query", "andMask", "notMask", "res", "entry", "Ctx2D", "setUpCanvas2D", "Time", "setUpTime", "Pointer", "setUpPointer", "canvas", "ctx", "updateTime", "time", "pointer", "e", "updatePointer", "Transform", "Hierarchy", "Eye", "Camera", "Rect", "Material", "Velocity", "Acceleration", "isPointer", "AngularVelocity", "addLimb", "world", "x", "y", "rect", "offset", "parent", "anchor", "limb", "attach", "addEye", "eyeWhiteRadius", "pupilRadius", "lookAtEntity", "eye", "addPerson", "headRect", "headOffset", "torsoRect", "torsoOffset", "limbRect", "limbOffset", "torso", "head", "leftEye", "rightEye", "leftUpperArm", "leftLowerArm", "rightUpperArm", "rightLowerArm", "leftUpperLeg", "leftLowerLeg", "rightUpperLeg", "rightLowerLeg", "handleAngularVelocity", "t", "av", "handleDrawRects", "r", "calculateHierarchyTransform", "c", "s", "handleDrawEyes", "dirX", "dirY", "mag", "m", "handleCamera", "camEntity", "p", "sin", "cos", "handleMovement", "world", "Velocity", "Acceleration", "e", "v", "a", "Time", "Transform", "t", "handlePointer", "isPointer", "cam", "Camera", "camComp", "camPos", "Pointer", "_", "k", "pointerEntity", "pos", "screenToWorld", "pointerToScreen", "Ctx2D", "Rect", "handleLookAtPointer", "Eye", "eye", "x", "y", "calculateHierarchyTransform", "pointerRect", "minDistance", "dx", "dy", "distance", "drawBackground", "color", "screenPos", "cameraPos", "cameraTilt", "cameraZoom", "cos", "sin", "res", "pointerPos", "canvas", "invertY", "out", "rect", "entity", "Hierarchy", "r", "h", "parentTransform", "c", "s", "_x", "_y", "attach", "parent", "child", "hp", "i", "l", "hc", "game", "World", "player", "addPerson", "AngularVelocity", "camera", "Transform", "Camera", "Hierarchy", "update", "drawBackground", "handleCamera", "handlePointer", "handleLookAtPointer", "handleDrawRects", "handleDrawEyes", "handleMovement", "handleAngularVelocity", "updateTime", "Time", "updatePointer", "Pointer"]
}
