(()=>{var i=class{storage=[];keyToIndex=new Map;indexToKey=[];objectFactory;constructor(e){this.objectFactory=e}size(){return this.keyToIndex.size}add(e){return this.keyToIndex.has(e)?this.storage[this.keyToIndex.get(e)]:(this.storage.length<=this.keyToIndex.size&&this.storage.push(this.objectFactory()),this.keyToIndex.set(e,this.keyToIndex.size),this.indexToKey[this.keyToIndex.size-1]=e,this.storage[this.keyToIndex.get(e)])}remove(e){let t=this.keyToIndex.get(e);if(t==null)return;let n=this.indexToKey[this.keyToIndex.size-1],o=this.storage[t];this.storage[t]=this.storage[this.keyToIndex.size-1],this.storage[this.keyToIndex.size-1]=o,this.indexToKey[t]=n,this.indexToKey.pop(),this.keyToIndex.set(n,t),this.keyToIndex.delete(e)}get(e){let t=this.keyToIndex.get(e);if(t==null)throw new Error("Key not found.");return this.storage[t]}has(e){return this.keyToIndex.has(e)}clean(){this.storage.splice(this.keyToIndex.size)}};var a=class{poolMap=new Map;idMap=new Map;register(e){this.poolMap.has(e)||(this.idMap.set(e,this.idMap.size),this.poolMap.set(e,new i(()=>({...e}))))}getId(e){let t=this.idMap.get(e);return t??(this.register(e),this.idMap.get(e))}add(e,t){return Object.assign(this.poolMap.get(t).add(e),t)}remove(e,t){this.poolMap.get(t).remove(e)}has(e,t){return this.poolMap.has(t)&&this.poolMap.get(t).has(e)}get(e,t){return this.poolMap.get(t).get(e)}size(e){return this.poolMap.get(e).size()}delete(e){for(let t of this.poolMap.entries())t[1].remove(e)}copy(e,t){for(let n of this.poolMap.entries())n[1].has(e)&&Object.assign(n[1].add(t),n[1].get(e))}clean(){for(let e of this.poolMap.entries())e[1].clean()}};function h(){return Math.random()}var r=class{compEntityMap=new Map;compManager=new a;entitySet=new Set;addEntity(e=h()){return this.entitySet.add(e),e}copyEntity(e,t=h()){this.compManager.copy(e,t);for(let n of this.compEntityMap)n[1].has(e)&&n[1].add(t);return this.entitySet.add(t),t}getCompEntityMap(e){let t=this.compEntityMap.get(e)??new Set;return this.compEntityMap.set(e,t),t}deleteEntity(e){this.compManager.delete(e);for(let t of this.compEntityMap)t[1].delete(e);this.entitySet.delete(e)}registerComponent(e){return this.compManager.register(e),this}hasComponent(e,t){return this.compManager.has(e,t)}addComponent(e,t,n=t){this.compManager.register(t);let o=this.getCompEntityMap(this.compManager.getId(t));return o.has(e)?Object.assign(this.compManager.get(e,t),n):(o.add(e),Object.assign(this.compManager.add(e,t),n))}removeComponent(e,t){this.compManager.register(t),this.getCompEntityMap(this.compManager.getId(t)).delete(e),this.compManager.remove(e,t)}getComponent(e,t){return this.compManager.get(e,t)}update(...e){for(let t=0,n=e.length;t<n;t++)e[t](this)}cleanObjectPools(){this.compManager.clean()}query(e){let t=this.entitySet;if(e.and)for(let n of e.and)t=t.intersection(this.getCompEntityMap(this.compManager.getId(n)));if(e.not)for(let n of e.not)t=t.difference(this.getCompEntityMap(this.compManager.getId(n)));return[...t]}entityCount(){return this.entitySet.size}};var d=u(),c=f(),p=y(),l=M(),g=[];function u(){let s=document.querySelector("canvas")??document.createElement("canvas");if(!s)throw new Error("Cannot create canvas element.");let e=s.getContext("webgl");if(!e)throw new Error("Cannot initialize webgl.");return document.body.appendChild(s),globalThis.onresize=globalThis.onload=()=>{innerWidth/innerHeight<s.width/s.height?(s.style.width="100%",s.style.height=""):(s.style.width="",s.style.height="100%")},{canvas:s,ctx:e}}function y(){let s={isDown:{},justPressed:{},justReleased:{}};return globalThis.onkeydown=e=>{!s.isDown[e.key]&&(s.justPressed[e.key]=!0),s.isDown[e.key]=!0},globalThis.onkeyup=e=>{s.isDown[e.key]=!1,s.justReleased[e.key]=!0},s}function m(s){for(let e in s.justPressed)s.justPressed[e]=!1;for(let e in s.justReleased)s.justReleased[e]=!1}function f(){let s={x:0,y:0,isDown:!1,justPressed:!1,justReleased:!1,pressPos:{x:0,y:0},releasePos:{x:0,y:0}};return globalThis.onpointerdown=e=>{s.x=e.x,s.y=e.y,Object.assign(s.pressPos,s),s.isDown=s.justPressed=!0},globalThis.onpointerup=e=>{s.x=e.x,s.y=e.y,Object.assign(s.releasePos,s),s.isDown=!1,s.justReleased=!0},globalThis.onpointermove=e=>{s.x=e.x,s.y=e.y},s}function x(s){s.justPressed=!1,s.justReleased=!1}function M(){return{dtMilli:0,timeMilli:0}}function T(s){s.dtMilli=performance.now()-s.timeMilli,s.timeMilli+=s.dtMilli}function w(s){}function E(s,e=d.ctx){let t=e.createTexture(),n=new Image;return n.src=s,n.onload=()=>{e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)},t}var I=E("./assets/roguelike_atlas.png");g.push(I);var C=new r;(function s(){d.ctx.clearColor(0,0,1,1),d.ctx.clear(d.ctx.COLOR_BUFFER_BIT),C.update(w),x(c),m(p),T(l),requestAnimationFrame(s)})();})();
//# sourceMappingURL=out.js.map
