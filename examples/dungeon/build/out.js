(()=>{var i=class{storage=[];keyToIndex=new Map;indexToKey=[];objectFactory;constructor(e){this.objectFactory=e}size(){return this.keyToIndex.size}add(e){return this.keyToIndex.has(e)?this.storage[this.keyToIndex.get(e)]:(this.storage.length<=this.keyToIndex.size&&this.storage.push(this.objectFactory()),this.keyToIndex.set(e,this.keyToIndex.size),this.indexToKey[this.keyToIndex.size-1]=e,this.storage[this.keyToIndex.get(e)])}remove(e){let t=this.keyToIndex.get(e);if(t==null)return;let a=this.indexToKey[this.keyToIndex.size-1],o=this.storage[t];this.storage[t]=this.storage[this.keyToIndex.size-1],this.storage[this.keyToIndex.size-1]=o,this.indexToKey[t]=a,this.indexToKey.pop(),this.keyToIndex.set(a,t),this.keyToIndex.delete(e)}get(e){let t=this.keyToIndex.get(e);if(t==null)throw new Error("Key not found.");return this.storage[t]}has(e){return this.keyToIndex.has(e)}clean(){this.storage.splice(this.keyToIndex.size)}};var r=class{poolMap=new Map;maskMap=new Map;register(e){this.poolMap.has(e)||(this.maskMap.set(e,1<<this.maskMap.size),this.poolMap.set(e,new i(()=>({...e}))))}getMask(e){let t=this.maskMap.get(e);return t??(this.register(e),this.maskMap.get(e))}add(e,t){return Object.assign(this.poolMap.get(t).add(e),t)}remove(e,t){this.poolMap.get(t).remove(e)}has(e,t){return this.poolMap.has(t)&&this.poolMap.get(t).has(e)}get(e,t){return this.poolMap.get(t).get(e)}size(e){return this.poolMap.get(e).size()}delete(e){for(let t of this.poolMap.entries())t[1].remove(e)}copy(e,t){for(let a of this.poolMap.entries())a[1].has(e)&&Object.assign(a[1].add(t),a[1].get(e))}clean(){for(let e of this.poolMap.entries())e[1].clean()}};function c(){return Math.random()}var h=class{maskMap=new Map;archetypeMap=new Map;compManager=new r;addEntity(e=c()){return this.maskMap.has(e)||this.maskMap.set(e,0),e}copyEntity(e,t=c()){this.compManager.copy(e,t);let a=this.maskMap.get(e)??0;return this.maskMap.set(t,a),this.getArchetype(a).add(t),t}getArchetype(e){let t=this.archetypeMap.get(e)??new Set;return this.archetypeMap.set(e,t),t}deleteEntity(e){this.compManager.delete(e),this.getArchetype(this.maskMap.get(e)??0).delete(e),this.maskMap.delete(e)}registerComponent(e){return this.compManager.register(e),this}hasComponent(e,t){return this.compManager.has(e,t)}addComponent(e,t,a=t){this.compManager.register(t);let o=this.maskMap.get(e)??0,n=this.compManager.getMask(t);return o&n?Object.assign(this.compManager.get(e,t),a):(this.getArchetype(o).delete(e),o^=n,this.maskMap.set(e,o),this.getArchetype(o).add(e),Object.assign(this.compManager.add(e,t),a))}removeComponent(e,t){this.compManager.register(t);let a=this.maskMap.get(e)??0,o=this.compManager.getMask(t);a&o^o||(this.compManager.remove(e,t),this.getArchetype(a).delete(e),a^=o,this.maskMap.set(e,a),this.getArchetype(a).add(e))}getComponent(e,t){return this.compManager.get(e,t)}update(...e){for(let t=0,a=e.length;t<a;t++)e[t](this)}cleanObjectPools(){this.compManager.clean()}query(e){let t=0,a=0;if(e.and)for(let n=0,p=e.and.length;n<p;n++)t|=this.compManager.getMask(e.and[n]);if(e.not)for(let n=0,p=e.not.length;n<p;n++)a|=this.compManager.getMask(e.not[n]);let o=[];for(let n of this.archetypeMap.entries())n[1].size>0&&(n[0]&t)==t&&(n[0]&a)==0&&o.push(...n[1]);return o}entityCount(){return this.maskMap.size}};var d=M(),l=x(),g=y(),u=T(),m=[];function M(){let s=document.querySelector("canvas")??document.createElement("canvas");if(!s)throw new Error("Cannot create canvas element.");let e=s.getContext("webgl");if(!e)throw new Error("Cannot initialize webgl.");return document.body.appendChild(s),globalThis.onresize=globalThis.onload=()=>{innerWidth/innerHeight<s.width/s.height?(s.style.width="100%",s.style.height=""):(s.style.width="",s.style.height="100%")},{canvas:s,ctx:e}}function y(){let s={isDown:{},justPressed:{},justReleased:{}};return globalThis.onkeydown=e=>{!s.isDown[e.key]&&(s.justPressed[e.key]=!0),s.isDown[e.key]=!0},globalThis.onkeyup=e=>{s.isDown[e.key]=!1,s.justReleased[e.key]=!0},s}function f(s){for(let e in s.justPressed)s.justPressed[e]=!1;for(let e in s.justReleased)s.justReleased[e]=!1}function x(){let s={x:0,y:0,isDown:!1,justPressed:!1,justReleased:!1,pressPos:{x:0,y:0},releasePos:{x:0,y:0}};return globalThis.onpointerdown=e=>{s.x=e.x,s.y=e.y,Object.assign(s.pressPos,s),s.isDown=s.justPressed=!0},globalThis.onpointerup=e=>{s.x=e.x,s.y=e.y,Object.assign(s.releasePos,s),s.isDown=!1,s.justReleased=!0},globalThis.onpointermove=e=>{s.x=e.x,s.y=e.y},s}function k(s){s.justPressed=!1,s.justReleased=!1}function T(){return{dtMilli:0,timeMilli:0}}function w(s){s.dtMilli=performance.now()-s.timeMilli,s.timeMilli+=s.dtMilli}function j(s){}function I(s,e=d.ctx){let t=e.createTexture(),a=new Image;return a.src=s,a.onload=()=>{e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a)},t}var b=I("./assets/roguelike_atlas.png");m.push(b);var C=new h;(function s(){d.ctx.clearColor(0,0,1,1),d.ctx.clear(d.ctx.COLOR_BUFFER_BIT),C.update(j),k(l),f(g),w(u),requestAnimationFrame(s)})();})();
//# sourceMappingURL=out.js.map
