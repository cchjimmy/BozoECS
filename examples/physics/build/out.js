(()=>{var k=class{storage=[];keyToIndex=new Map;indexToKey=[];objectFactory;constructor(t){this.objectFactory=t}size(){return this.keyToIndex.size}add(t){return this.keyToIndex.has(t)?this.storage[this.keyToIndex.get(t)]:(this.storage.length<=this.keyToIndex.size&&this.storage.push(this.objectFactory()),this.keyToIndex.set(t,this.keyToIndex.size),this.indexToKey[this.keyToIndex.size-1]=t,this.storage[this.keyToIndex.get(t)])}remove(t){let e=this.keyToIndex.get(t);if(e==null)return;let o=this.indexToKey[this.keyToIndex.size-1],s=this.storage[e];this.storage[e]=this.storage[this.keyToIndex.size-1],this.storage[this.keyToIndex.size-1]=s,this.indexToKey[e]=o,this.indexToKey.pop(),this.keyToIndex.set(o,e),this.keyToIndex.delete(t)}get(t){let e=this.keyToIndex.get(t);if(e==null)throw new Error("Key not found.");return this.storage[e]}has(t){return this.keyToIndex.has(t)}clean(){this.storage.splice(this.keyToIndex.size)}};var S=class{poolMap=new Map;idMap=new Map;register(t){this.poolMap.has(t)||(this.idMap.set(t,this.idMap.size),this.poolMap.set(t,new k(()=>({...t}))))}getId(t){let e=this.idMap.get(t);return e??(this.register(t),this.idMap.get(t))}add(t,e){return Object.assign(this.poolMap.get(e).add(t),e)}remove(t,e){this.poolMap.get(e).remove(t)}has(t,e){return this.poolMap.has(e)&&this.poolMap.get(e).has(t)}get(t,e){return this.poolMap.get(e).get(t)}size(t){return this.poolMap.get(t).size()}delete(t){for(let e of this.poolMap.entries())e[1].remove(t)}copy(t,e){for(let o of this.poolMap.entries())o[1].has(t)&&Object.assign(o[1].add(e),o[1].get(t))}clean(){for(let t of this.poolMap.entries())t[1].clean()}};function b(){return Math.random()}var I=class{compEntityMap=new Map;compManager=new S;entitySet=new Set;addEntity(t=b()){return this.entitySet.add(t),t}copyEntity(t,e=b()){this.compManager.copy(t,e);for(let o of this.compEntityMap)o[1].has(t)&&o[1].add(e);return this.entitySet.add(e),e}getCompEntityMap(t){let e=this.compEntityMap.get(t)??new Set;return this.compEntityMap.set(t,e),e}deleteEntity(t){this.compManager.delete(t);for(let e of this.compEntityMap)e[1].delete(t);this.entitySet.delete(t)}registerComponent(t){return this.compManager.register(t),this}hasComponent(t,e){return this.compManager.has(t,e)}addComponent(t,e,o=e){this.compManager.register(e);let s=this.getCompEntityMap(this.compManager.getId(e));return s.has(t)?Object.assign(this.compManager.get(t,e),o):(s.add(t),Object.assign(this.compManager.add(t,e),o))}removeComponent(t,e){this.compManager.register(e);let o=this.getCompEntityMap(this.compManager.getId(e));o.has(t)&&(o.delete(t),this.compManager.remove(t,e))}getComponent(t,e){return this.compManager.get(t,e)}update(...t){for(let e=0,o=t.length;e<o;e++)t[e](this)}cleanObjectPools(){this.compManager.clean()}query(t){let e=this.entitySet,o={and:[],not:[]};Object.assign(o,t);for(let s of o.and)e=e.intersection(this.getCompEntityMap(this.compManager.getId(s)));for(let s of o.not)e=e.difference(this.getCompEntityMap(this.compManager.getId(s)));return[...e]}entityCount(){return this.entitySet.size}};var p={dtMilli:0,timeMilli:0,dtSeconds:0,timeSeconds:0},i=P();function K(n){n.dtMilli=performance.now()-n.timeMilli,n.timeMilli+=n.dtMilli,n.dtSeconds=n.dtMilli/1e3,n.timeSeconds=n.timeMilli/1e3}function P(){let n=document.querySelector("canvas");n==null&&(n=document.createElement("canvas"),document.body.appendChild(n));let t=n.getContext("2d");if(!t)throw new Error("Cannot initialize 2D context.");return{canvas:n,ctx:t}}var r={x:0,y:0},C={x:0,y:0},v={x:0,y:0},x={kg:0},g={x:0,y:0},z={radius:5},q={content:"placeholder",font:"20px sans-serif"};function D(n){for(let t of n.query({and:[C,v]})){let e=n.getComponent(t,C),o=n.getComponent(t,v);e.x+=o.x*p.dtSeconds,e.y+=o.y*p.dtSeconds}for(let t of n.query({and:[r,C]})){let e=n.getComponent(t,r),o=n.getComponent(t,C);e.x+=o.x*p.dtSeconds,e.y+=o.y*p.dtSeconds}}function O(n){for(let t of n.query({and:[g,x,v]})){let e=n.getComponent(t,g),o=n.getComponent(t,x).kg,s=n.getComponent(t,v);s.x=e.x/o,s.y=e.y/o,e.x=e.y=0}}function A(n){let t=n.query({and:[g,x,r]}),e=[],o=[],s=[];for(let a of t)e.push(n.getComponent(a,g)),o.push(n.getComponent(a,x).kg),s.push(n.getComponent(a,r));for(let a=0,c=e.length;a<c;a++){let h=o[a],m=s[a];for(let d=0;d<c;d++){if(d==a)continue;let f=e[d],T=o[d],M=s[d],l=M.x-m.x,y=M.y-m.y,u=(l*l+y*y)**.5;f.x-=(6.674*10)**-11*(h*T)/u**3*l,f.y-=(6.674*10)**-11*(h*T)/u**3*y}}}function R(n){i.ctx.strokeStyle="red",i.ctx.beginPath();for(let t of n.query({and:[r,z]})){let e=n.getComponent(t,r),o=n.getComponent(t,z).radius;i.ctx.moveTo(e.x+o,e.y),i.ctx.arc(e.x,e.y,o,0,Math.PI*2)}i.ctx.stroke()}function w(n){i.ctx.fillStyle="white";for(let t of n.query({and:[q,r]})){let e=n.getComponent(t,q),o=n.getComponent(t,r),s=e.content.split(`
`);i.ctx.font=e.font;let a=i.ctx.measureText(e.content);for(let c=0,h=s.length;c<h;c++)i.ctx.fillText(s[c],o.x,o.y+a.emHeightAscent*(c+1))}}function B(n){i.ctx.strokeStyle="white",i.ctx.beginPath();let t=[],e=[],o=[],s=i.canvas.width/10;for(let a of n.query({and:[r,g,x]}))t.push(n.getComponent(a,r)),e.push(n.getComponent(a,g)),o.push(n.getComponent(a,x).kg);for(let a=s;a<i.canvas.width;a+=s)for(let c=s;c<i.canvas.height;c+=s){let h=0,m=0;for(let f=0,T=e.length;f<T;f++){let M=o[f],l=t[f],y=l.x-a,u=l.y-c,j=(y*y+u*u)**.5;h+=(6.674*10)**-11*M/j**3*y,m+=(6.674*10)**-11*M/j**3*u}let d=(h*h+m*m)**.5/(s/2);i.ctx.moveTo(a,c),i.ctx.lineTo(a+h/d,c+m/d),i.ctx.moveTo(a+s/10,c),i.ctx.arc(a,c,s/10,0,Math.PI*2)}i.ctx.stroke()}function F(n,t,e,o){let s=n.addEntity();return n.addComponent(s,r,{x:t,y:e}),n.addComponent(s,x,{kg:o}),n.addComponent(s,C),n.addComponent(s,v),n.addComponent(s,g),n.addComponent(s,z,{radius:5}),n.addComponent(s,q,{content:`${o.toExponential(2)} kg`,font:"10px sans-serif"}),s}var E=new I;i.canvas.width=200;i.canvas.height=200;i.canvas.style.imageRendering="pixelated";F(E,i.canvas.width/2,i.canvas.height/2,1e25);var H=F(E,i.canvas.width/2+40,i.canvas.height/2,1);E.addComponent(H,g,{y:1480});(function n(){requestAnimationFrame(n),p.timeSeconds%(1/30)<p.dtSeconds&&(p.dtSeconds=1/30,i.ctx.fillStyle="#424242",i.ctx.fillRect(0,0,i.canvas.width,i.canvas.height),E.update(O,A,R,B,w,D)),K(p)})();})();
//# sourceMappingURL=out.js.map
