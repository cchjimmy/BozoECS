(()=>{var T=class{storage=[];keyToIndex=new Map;indexToKey=[];objectFactory;constructor(t){this.objectFactory=t}size(){return this.keyToIndex.size}add(t){return this.keyToIndex.has(t)?this.storage[this.keyToIndex.get(t)]:(this.storage.length<=this.keyToIndex.size&&this.storage.push(this.objectFactory()),this.keyToIndex.set(t,this.keyToIndex.size),this.indexToKey[this.keyToIndex.size-1]=t,this.storage[this.keyToIndex.get(t)])}remove(t){let e=this.keyToIndex.get(t);if(e==null)return;let s=this.indexToKey[this.keyToIndex.size-1],o=this.storage[e];this.storage[e]=this.storage[this.keyToIndex.size-1],this.storage[this.keyToIndex.size-1]=o,this.indexToKey[e]=s,this.indexToKey.pop(),this.keyToIndex.set(s,e),this.keyToIndex.delete(t)}get(t){let e=this.keyToIndex.get(t);if(e==null)throw new Error("Key not found.");return this.storage[e]}has(t){return this.keyToIndex.has(t)}clean(){this.storage.splice(this.keyToIndex.size)}};var I=class{poolMap=new Map;maskMap=new Map;register(t){this.poolMap.has(t)||(this.maskMap.set(t,BigInt(2**this.maskMap.size)),this.poolMap.set(t,new T(()=>({...t}))))}getMask(t){let e=this.maskMap.get(t);return e??(this.register(t),this.maskMap.get(t))}add(t,e){return Object.assign(this.poolMap.get(e).add(t),e)}remove(t,e){this.poolMap.get(e).remove(t)}has(t,e){return this.poolMap.has(e)&&this.poolMap.get(e).has(t)}get(t,e){return this.poolMap.get(e).get(t)}size(t){return this.poolMap.get(t).size()}delete(t){for(let e of this.poolMap.entries())e[1].remove(t)}copy(t,e){for(let s of this.poolMap.entries())s[1].has(t)&&Object.assign(s[1].add(e),s[1].get(t))}clean(){for(let t of this.poolMap.entries())t[1].clean()}};function b(){return Math.random()}var S=class{maskMap=new Map;archetypeMap=new Map;compManager=new I;addEntity(t=b()){return this.maskMap.has(t)||this.maskMap.set(t,0n),t}copyEntity(t,e=b()){this.compManager.copy(t,e);let s=this.maskMap.get(t)??0n;return this.maskMap.set(e,s),this.getArchetype(s).add(e),e}getArchetype(t){let e=this.archetypeMap.get(t)??new Set;return this.archetypeMap.set(t,e),e}deleteEntity(t){this.compManager.delete(t),this.getArchetype(this.maskMap.get(t)??0n).delete(t),this.maskMap.delete(t)}registerComponent(t){return this.compManager.register(t),this}hasComponent(t,e){return this.compManager.has(t,e)}addComponent(t,e,s=e){this.compManager.register(e);let o=this.maskMap.get(t)??0n,a=this.compManager.getMask(e);return o&a?Object.assign(this.compManager.get(t,e),s):(this.getArchetype(o).delete(t),o^=a,this.maskMap.set(t,o),this.getArchetype(o).add(t),Object.assign(this.compManager.add(t,e),s))}removeComponent(t,e){this.compManager.register(e);let s=this.maskMap.get(t)??0n,o=this.compManager.getMask(e);s&o^o||(this.compManager.remove(t,e),this.getArchetype(s).delete(t),s^=o,this.maskMap.set(t,s),this.getArchetype(s).add(t))}getComponent(t,e){return this.compManager.get(t,e)}update(...t){for(let e=0,s=t.length;e<s;e++)t[e](this)}cleanObjectPools(){this.compManager.clean()}query(t){let e=0n,s=0n;if(t.and)for(let a=0,c=t.and.length;a<c;a++)e|=this.compManager.getMask(t.and[a]);if(t.not)for(let a=0,c=t.not.length;a<c;a++)s|=this.compManager.getMask(t.not[a]);let o=[];for(let a of this.archetypeMap.entries())a[1].size>0&&(a[0]&e)==e&&(a[0]&s)==0n&&o.push(...a[1]);return o}entityCount(){return this.maskMap.size}};var d={dtMilli:0,timeMilli:0,dtSeconds:0,timeSeconds:0},i=P();function K(n){n.dtMilli=performance.now()-n.timeMilli,n.timeMilli+=n.dtMilli,n.dtSeconds=n.dtMilli/1e3,n.timeSeconds=n.timeMilli/1e3}function P(){let n=document.querySelector("canvas");n==null&&(n=document.createElement("canvas"),document.body.appendChild(n));let t=n.getContext("2d");if(!t)throw new Error("Cannot initialize 2D context.");return{canvas:n,ctx:t}}var r={x:0,y:0},k={x:0,y:0},C={x:0,y:0},l={kg:0},g={x:0,y:0},A={radius:5},j={content:"placeholder",font:"20px sans-serif"};function q(n){for(let t of n.query({and:[k,C]})){let e=n.getComponent(t,k),s=n.getComponent(t,C);e.x+=s.x*d.dtSeconds,e.y+=s.y*d.dtSeconds}for(let t of n.query({and:[r,k]})){let e=n.getComponent(t,r),s=n.getComponent(t,k);e.x+=s.x*d.dtSeconds,e.y+=s.y*d.dtSeconds}}function D(n){for(let t of n.query({and:[g,l,C]})){let e=n.getComponent(t,g),s=n.getComponent(t,l).kg,o=n.getComponent(t,C);o.x=e.x/s,o.y=e.y/s,e.x=e.y=0}}function O(n){let t=n.query({and:[g,l,r]}),e=[],s=[],o=[];for(let a of t)e.push(n.getComponent(a,g)),s.push(n.getComponent(a,l).kg),o.push(n.getComponent(a,r));for(let a=0,c=e.length;a<c;a++){let h=s[a],m=o[a];for(let p=0;p<c;p++){if(p==a)continue;let x=e[p],v=s[p],u=o[p],M=u.x-m.x,f=u.y-m.y,y=(M*M+f*f)**.5;x.x-=(6.674*10)**-11*(h*v)/y**3*M,x.y-=(6.674*10)**-11*(h*v)/y**3*f}}}function B(n){i.ctx.strokeStyle="red",i.ctx.beginPath();for(let t of n.query({and:[r,A]})){let e=n.getComponent(t,r),s=n.getComponent(t,A).radius;i.ctx.moveTo(e.x+s,e.y),i.ctx.arc(e.x,e.y,s,0,Math.PI*2)}i.ctx.stroke()}function R(n){i.ctx.fillStyle="white";for(let t of n.query({and:[j,r]})){let e=n.getComponent(t,j),s=n.getComponent(t,r),o=e.content.split(`
`);i.ctx.font=e.font;let a=i.ctx.measureText(e.content);for(let c=0,h=o.length;c<h;c++)i.ctx.fillText(o[c],s.x,s.y+a.emHeightAscent*(c+1))}}function w(n){i.ctx.strokeStyle="white",i.ctx.beginPath();let t=[],e=[],s=[],o=i.canvas.width/10;for(let a of n.query({and:[r,g,l]}))t.push(n.getComponent(a,r)),e.push(n.getComponent(a,g)),s.push(n.getComponent(a,l).kg);for(let a=o;a<i.canvas.width;a+=o)for(let c=o;c<i.canvas.height;c+=o){let h=0,m=0;for(let x=0,v=e.length;x<v;x++){let u=s[x],M=t[x],f=M.x-a,y=M.y-c,E=(f*f+y*y)**.5;h+=(6.674*10)**-11*u/E**3*f,m+=(6.674*10)**-11*u/E**3*y}let p=(h*h+m*m)**.5/(o/2);i.ctx.moveTo(a,c),i.ctx.lineTo(a+h/p,c+m/p),i.ctx.moveTo(a+o/10,c),i.ctx.arc(a,c,o/10,0,Math.PI*2)}i.ctx.stroke()}function F(n,t,e,s){let o=n.addEntity();return n.addComponent(o,r,{x:t,y:e}),n.addComponent(o,l,{kg:s}),n.addComponent(o,k),n.addComponent(o,C),n.addComponent(o,g),n.addComponent(o,A,{radius:5}),n.addComponent(o,j,{content:`${s.toExponential(2)} kg`,font:"10px sans-serif"}),o}var z=new S;i.canvas.width=200;i.canvas.height=200;i.canvas.style.imageRendering="pixelated";F(z,i.canvas.width/2,i.canvas.height/2,1e25);var H=F(z,i.canvas.width/2+40,i.canvas.height/2,1);z.addComponent(H,g,{y:1480});(function n(){requestAnimationFrame(n),d.timeSeconds%(1/30)<d.dtSeconds&&(d.dtSeconds=1/30,i.ctx.fillStyle="#424242",i.ctx.fillRect(0,0,i.canvas.width,i.canvas.height),z.update(D,O,B,w,R,q)),K(d)})();})();
//# sourceMappingURL=out.js.map
